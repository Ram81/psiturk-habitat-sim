!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=23)}([function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e,n){var i=n(12),r=n(13),o=n(14),s=n(16);t.exports=function(t,e){return i(t)||r(t,e)||o(t,e)||s()}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e,n){var i=n(17);function r(e,n,o){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=r=Reflect.get:t.exports=r=function(t,e,n){var r=i(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},r(e,n,o||e)}t.exports=r},function(t,e,n){var i=n(18);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}},function(t,e,n){var i=n(9),r=n(0);t.exports=function(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?r(t):e}},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,e,n){"use strict";var i,r=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},o=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),s=[];function a(t){for(var e=-1,n=0;n<s.length;n++)if(s[n].identifier===t){e=n;break}return e}function c(t,e){for(var n={},i=[],r=0;r<t.length;r++){var o=t[r],c=e.base?o[0]+e.base:o[0],u=n[c]||0,l="".concat(c," ").concat(u);n[c]=u+1;var h=a(l),f={css:o[1],media:o[2],sourceMap:o[3]};-1!==h?(s[h].references++,s[h].updater(f)):s.push({identifier:l,updater:m(f,e),references:1}),i.push(l)}return i}function u(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var r=n.nc;r&&(i.nonce=r)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var s=o(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var l,h=(l=[],function(t,e){return l[t]=e,l.filter(Boolean).join("\n")});function f(t,e,n,i){var r=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=h(e,r);else{var o=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}function d(t,e,n){var i=n.css,r=n.media,o=n.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),o&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var p=null,v=0;function m(t,e){var n,i,r;if(e.singleton){var o=v++;n=p||(p=u(e)),i=f.bind(null,n,o,!1),r=f.bind(null,n,o,!0)}else n=u(e),i=d.bind(null,n,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var n=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<n.length;i++){var r=a(n[i]);s[r].references--}for(var o=c(t,e),u=0;u<n.length;u++){var l=a(n[u]);0===s[l].references&&(s[l].updater(),s.splice(l,1))}n=o}}}},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var r=(s=i,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(c," */")),o=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[n].concat(o).concat([r]).join("\n")}var s,a,c;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(i)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(r[s]=!0)}for(var a=0;a<t.length;a++){var c=[].concat(t[a]);i&&r[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),e.push(c))}},e}},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}}},function(t,e,n){var i=n(15);t.exports=function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,n){var i=n(5);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=i(t)););return t}},function(t,e){function n(e,i){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,i)}t.exports=n},function(t,e,n){var i=n(10),r=n(20);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var o={insert:"head",singleton:!1};i(r,o);t.exports=r.locals||{}},function(t,e,n){(e=n(11)(!1)).push([t.i,".viewer-canvas {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  left: 0;\n  overflow: hidden;\n}\n\n.hidden {\n  display: hidden;\n}\n\n.tooltip {\n  color: #fff;\n  background-color: #666;\n  line-height: 2;\n  border-radius: 2px;\n  top: 0;\n  padding-top: 3px;\n  padding-bottom: 3px;\n  position: absolute;\n  z-index: 100;\n  text-align: center;\n  width: 100%;\n}\n\n.mobile-warning {\n  position: absolute;\n  bottom: 5px;\n}\n",""]),t.exports=e},function(t,e,n){var i=n(10),r=n(22);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var o={insert:"head",singleton:!1};i(r,o);t.exports=r.locals||{}},function(t,e,n){(e=n(11)(!1)).push([t.i,"/** Copyright (c) Facebook, Inc. and its affiliates.\n *  This source code is licensed under the MIT license found in the\n *  LICENSE file in the root directory of this source tree.\n */\n#radar {\n  position: absolute;\n  top: 70%;\n  left: 50%;\n  margin-left: -50px;\n  width: 100;\n  height: 100;\n  z-index: 9;\n  pointer-events: none;\n  visibility: hidden;\n}\n\n#scope {\n  position: absolute;\n  border-color: red;\n  border-style: dashed;\n  border-width: 5px;\n  opacity: 0.4;\n  top: 50%;\n  left: 50%;\n  margin-left: -160px;\n  margin-top: -120px;\n  width: 320px;\n  height: 240px;\n  z-index: 9;\n  pointer-events: none;\n}\n\n#fps {\n  text-align: right;\n  padding-right: 1em;\n}\n\n#warning {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  z-index: 100;\n  background-color: #fff;\n  color: #000;\n}\n\n.hidden {\n  display: none !important;\n}\n",""]),t.exports=e},function(t,e,n){"use strict";n.r(e);var i=n(2),r=n.n(i),o=n(3),s=n.n(o),a=n(1),c=n.n(a),u={height:1.5,radius:.1,mass:32,linearAcceleration:20,angularAcceleration:4*Math.PI,linearFriction:.5,angularFriction:1,coefficientOfRestitution:0},l={startState:{position:[-1.2676633596420288,.2047852873802185,12.595427513122559],rotation:[0,.4536385088584658,0,.8911857849408661]},goal:{position:[2.2896811962127686,.11950381100177765,16.97636604309082]}},h={height:480,width:640},f=-1===window.location.href.indexOf("localhost")?"https://habitat-resources.s3.amazonaws.com/data/scene_datasets/habitat-test-scenes/skokloster-castle.glb":"skokloster-castle.glb",d=["cylinderSolid_rings_1_segments_12_halfLen_1_useTexCoords_false_useTangents_false_capEnds_true"],p=["/data/objects/sphere.phys_properties.json","/data/objects/chair.phys_properties.json"],v=[{objectName:"sphere.glb",objectHandle:"sphere.phys_properties.json",physicsProperties:"test_assets/objects/sphere.phys_properties.json",renderMesh:"test_assets/objects/sphere.glb"},{objectName:"chair.glb",objectHandle:"chair.phys_properties.json",physicsProperties:"test_assets/objects/chair.phys_properties.json",renderMesh:"test_assets/objects/chair.glb"}],m=n(4),g=n.n(m),y=n(9),b=n.n(y);function w(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return S(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function j(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=!1;return function(){var i=arguments,r=this;n||(t.apply(r,i),n=!0,window.setTimeout((function(){n=!1}),e))}}function O(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=w(window.location.search.substr(1).split("&"));try{for(n.s();!(t=n.n()).done;){var i=t.value,r=i.split("="),o=g()(r,2),s=o[0],a=o[1];s&&a&&(e[s]=decodeURIComponent(a))}}catch(t){n.e(t)}finally{n.f()}return e}function k(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return Math.floor(Math.random()*t)}function M(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return A(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var T=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r()(this,t),this.sim=new Module.Simulator(e),this.pathfinder=this.sim.getPathFinder(),this.setEpisode(n),this.resolution=null,this.grippedObjectId=-1,this.gripOffset=null,this.selectedAgentId=i}return s()(t,[{key:"reset",value:function(){(this.sim.reset(),null!==this.initialAgentState)&&this.sim.getAgent(this.selectedAgentId).setState(this.initialAgentState,!0);this.updateCrossHairNode(this.getCrosshairPosition()),this.syncObjects(),this.addRandomObjects(),this.grippedObjectId=-1,this.gripOffset=null}},{key:"changeAgent",value:function(t){this.selectedAgentId=t}},{key:"setEpisode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.episode=t,this.initialAgentState=null,Object.keys(t).length>0&&(this.initialAgentState=this.createAgentState(t.startState))}},{key:"updateCrossHairNode",value:function(t){this.sim.updateCrossHairNode(t)}},{key:"syncObjects",value:function(){this.sim.syncGrippedObject(this.grippedObjectId)}},{key:"addRandomObjects",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,e=0;e<t;e++)e%2==0?this.addTemplateObject():this.addPrimitiveObject();this.recomputeNavMesh()}},{key:"step",value:function(t){this.sim.getAgent(this.selectedAgentId).act(t)}},{key:"addAgent",value:function(t){var e=this.createAgentConfig(t);return this.resolution=this.flipVec2i(e.sensorSpecifications.get(0).resolution),this.sim.addAgent(e)}},{key:"addObject",value:function(t){return this.sim.addObject(t,null,"",0)}},{key:"removeObject",value:function(t){return this.sim.removeObject(t,!0,!0,0)}},{key:"addObjectByHandle",value:function(t){return this.sim.addObjectByHandle(t,null,"",0)}},{key:"addPrimitiveObject",value:function(){var t=k(d.length),e=d[t],n=this.addObjectByHandle(e),i=this.pathfinder.getRandomNavigablePoint(),r=this.convertVec3fToVector3(i);return this.setTranslation(r,n,0),this.setObjectMotionType(Module.MotionType.STATIC,n,0),n}},{key:"addTemplateObject",value:function(){var t=k(p.length),e=p[t],n=this.addObjectByHandle(e),i=this.pathfinder.getRandomNavigablePoint(),r=this.convertVec3fToVector3(i);return this.setTranslation(r,n,0),this.setObjectMotionType(Module.MotionType.STATIC,n,0),n}},{key:"removeLastObject",value:function(){var t=this.getExistingObjectIDs();this.removeObject(t.get(t.size()-1))}},{key:"grabReleaseObject",value:function(){var t=this.getCrosshairPosition(),e=this.unproject(t).direction,n=this.getAgentAbsoluteTranslation(0),i=this.findNearestObjectUnderCrosshair(0,e,n,this.resolution),r=this.getAgentTransformation(0);if(-1!=this.grippedObjectId){this.setTransformation(r.mul(this.gripOffset),this.grippedObjectId,0);var o=this.getTranslation(this.grippedObjectId,0);if(!this.pathfinder.isNavigable(this.convertVector3ToVec3f(o),.5))return void console.log("Colliding with object or position is not navigable");this.setObjectMotionType(Module.MotionType.STATIC,this.grippedObjectId,0),this.grippedObjectId=-1}else{if(-1==i)return;this.gripOffset=r.inverted().mul(this.getTransformation(i,0)),this.setObjectMotionType(Module.MotionType.KINEMATIC,i,0),this.grippedObjectId=i}this.recomputeNavMesh()}},{key:"getObservationSpace",value:function(t){return this.sim.getAgentObservationSpace(this.selectedAgentId,t)}},{key:"getObservation",value:function(t,e){return this.sim.getAgentObservation(this.selectedAgentId,t,e),e}},{key:"getPathFinder",value:function(){return this.sim.getPathFinder()}},{key:"getObjectMotionType",value:function(t,e){return this.sim.getObjectMotionType(t,e)}},{key:"setObjectMotionType",value:function(t,e,n){return this.sim.setObjectMotionType(t,e,n)}},{key:"getExistingObjectIDs",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.sim.getExistingObjectIDs(t)}},{key:"setTransformation",value:function(t,e,n){this.sim.setTransformation(t,e,n)}},{key:"getTransformation",value:function(t,e){return this.sim.getTransformation(t,e)}},{key:"getTranslation",value:function(t,e){return this.sim.getTranslation(t,e)}},{key:"setTranslation",value:function(t,e,n){this.sim.setTranslation(t,e,n)}},{key:"getRotation",value:function(t,e){return this.sim.getRotation(t,e)}},{key:"setRotation",value:function(t,e,n){this.sim.setRotation(t,e,n)}},{key:"stepWorld",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/60;return this.sim.stepWorld(t)}},{key:"displayObservation",value:function(t){this.sim.displayObservation(0,t)}},{key:"getSemanticScene",value:function(){return this.sim.getSemanticScene()}},{key:"getAgent",value:function(t){return this.sim.getAgent(t)}},{key:"getAgentTransformation",value:function(t){return this.sim.getAgentTransformation(t)}},{key:"getAgentAbsoluteTranslation",value:function(t){return this.sim.getAgentAbsoluteTranslation(t)}},{key:"getAgentState",value:function(){var t=new Module.AgentState;return this.sim.getAgent(this.selectedAgentId).getState(t),t}},{key:"getCrosshairPosition",value:function(){return this.resolution.map((function(t){return.5*t}))}},{key:"recomputeNavMesh",value:function(){var t=new Module.NavMeshSettings;t.setDefaults(),t.agentRadius=.3,this.sim.recomputeNavMesh(this.getPathFinder(),t,!0)}},{key:"toggleNavMeshVisualization",value:function(){this.sim.toggleNavMeshVisualization()}},{key:"findNearestObjectUnderCrosshair",value:function(t,e,n,i){return this.sim.findNearestObjectUnderCrosshair(t,e,n,i,1)}},{key:"unproject",value:function(t){return this.sim.unproject(t)}},{key:"convertVector3ToVec3f",value:function(t){return[t.x(),t.y(),t.z()]}},{key:"convertVec3fToVector3",value:function(t){return new Module.Vector3(t[0],t[1],t[2])}},{key:"flipVec2i",value:function(t){return[t[1],t[0]]}},{key:"distanceToGoal",value:function(){if(0===Object.keys(this.episode).length)return[0,0];var t=this.episode.goal.position,e=this.getAgentState(),n=e.position,i=[t[0]-n[0],t[1]-n[1],t[2]-n[2]];return i=this.applyRotation(i,e.rotation),this.cartesian_to_polar(-i[2],i[0])}},{key:"applyRotation",value:function(t,e){var n,i,r,o,s,a,c,u=g()(t,3);n=u[0],i=u[1],r=u[2];var l=g()(e,4);o=l[0],s=l[1],a=l[2];var h=(c=l[3])*n-s*r+a*i,f=c*i-a*n+o*r,d=c*r-o*i+s*n,p=o*n+s*i+a*r,v=[];return v[0]=h*c+p*o+f*a-d*s,v[1]=f*c+p*s+d*o-h*a,v[2]=d*c+p*a+h*s-f*o,v}},{key:"cartesian_to_polar",value:function(t,e){return[Math.sqrt(t*t+e*e),Math.atan2(e,t)]}},{key:"createSensorSpec",value:function(t){var e=new Module.SensorSpec;for(var n in t){var i=t[n];e[n]=i}return e}},{key:"createAgentConfig",value:function(t){var e=new Module.AgentConfiguration;for(var n in t){var i=t[n];if("sensorSpecifications"===n){var r,o=new Module.VectorSensorSpec,s=M(i);try{for(s.s();!(r=s.n()).done;){var a=r.value;o.push_back(this.createSensorSpec(a))}}catch(t){s.e(t)}finally{s.f()}i=o}e[n]=i}return e}},{key:"createAgentState",value:function(t){var e=new Module.AgentState;for(var n in t){var i=t[n];e[n]=i}return e}}]),t}(),x=function(){function t(e,n){r()(this,t),this.pathFinder=e,this.bounds=e.bounds,this.canvas=n,this.ctx=n.getContext("2d"),this.widthComponent=0,this.heightComponent=2,this.scale=1,this.ctx.strokeStyle="blue",this.ctx.lineWidth=3,this.currentY=-1/0}return s()(t,[{key:"draw",value:function(){var t=this.ctx,e=this.canvas,n=this.mapCenterInset(),i=g()(n,2),r=i[0],o=i[1];t.clearRect(0,0,e.width,e.height),t.putImageData(this.imageData,r,o)}},{key:"start",value:function(t){this.currentY=t[1],this.imageData=this.createMap(),this.draw();var e=this.convertPosition(t),n=g()(e,2),i=n[0],r=n[1];this.ctx.beginPath(),this.ctx.moveTo(i,r)}},{key:"moveTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0!==e)this.throttledMoveTo||(this.throttledMoveTo=j(this.moveTo.bind(this),e)),this.throttledMoveTo(t);else if(t[1]<this.currentY-.25||t[1]>this.currentY+.25)this.start(t);else{var n=this.convertPosition(t),i=g()(n,2),r=i[0],o=i[1];this.ctx.lineTo(r,o),this.ctx.stroke()}}},{key:"mapCenterInset",value:function(){return[(this.canvas.width-this.imageData.width)/2,(this.canvas.height-this.imageData.height)/2]}},{key:"convertPosition",value:function(t){var e=this.widthComponent,n=this.heightComponent,i=this.mapCenterInset(),r=g()(i,2),o=r[0],s=r[1];return[o+=(t[e]-this.bounds.min[e])*this.scale,s+=(t[n]-this.bounds.min[n])*this.scale]}},{key:"createMap",value:function(){var t=this.canvas,e=this.bounds.max[0]-this.bounds.min[0],n=this.bounds.max[2]-this.bounds.min[2],i=0,r=0;if(e>n&&t.width<t.height||e<n&&t.width>t.height){this.widthComponent=2,this.heightComponent=0;var o=e;e=n,n=o}n/e>t.height/t.width?(this.scale=t.height/n,i=t.height,r=Math.round(e*this.scale-.5)):(this.scale=t.width/e,r=t.width,i=Math.round(n*this.scale-.5));var s,a,c=new ImageData(r,i),u=4*t.width,l=1/this.scale,h=this.bounds.min[this.heightComponent]+l/2;for(s=0;s<i;s++){var f=this.bounds.min[this.widthComponent]+l/2;for(a=0;a<r;a++){var d=[0,this.currentY,0];d[this.widthComponent]=f,d[this.heightComponent]=h,this.pathFinder.isNavigable(d,.5)&&(c.data[s*u+4*a]=255,c.data[s*u+4*a+1]=255,c.data[s*u+4*a+2]=255,c.data[s*u+4*a+3]=255),f+=l}h+=l}return c}}]),t}(),I=function(){function t(e,n,i,o){r()(this,t),this.rect=e,this.semanticShape=n,this.semanticScene=i,this.objectIds=[];for(var s=this.semanticScene.categories,a=this.semanticScene.objects,c=-1,u=0;u<s.size();u++){var l=s.get(u);if(l&&l.getName("")===o){c=l.getIndex("");break}}for(var h=0;h<a.size();h++){var f=a.get(h)||{};f.category&&f.category.getIndex("")===c&&this.objectIds.push(h)}}return s()(t,[{key:"computeIOU",value:function(t){for(var e=this.semanticShape.get(1),n=this.semanticShape.get(0),i=this.rect.left,r=this.rect.top,o=this.rect.right,s=this.rect.bottom,a=0,c=0,u=!1,l=0;l<n;l++){u=l>=r&&l<s;for(var h=0;h<e;h++)this.objectIds.includes(t[l*e+h])&&(u&&h>=i&&h<o?a++:c++)}return 0===a?0:a/(c+(s-r)*(o-i))}}]),t}();function C(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return P(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var R=function(){function t(e,n){var i=this;if(r()(this,t),this.sim=e,this.components=n,this.topdown=n.topdown,this.semanticsEnabled=!1,this.radarEnabled=!1,this.components.semantic){if(this.semanticsEnabled=!0,this.semanticCtx=n.semantic.getContext("2d"),this.semanticShape=this.sim.getObservationSpace("semantic").shape,this.semanticImageData=this.semanticCtx.createImageData(this.semanticShape.get(1),this.semanticShape.get(0)),this.semanticObservation=new Module.Observation,this.semanticScene=this.sim.sim.getSemanticScene(),this.semanticObjects=this.semanticScene.objects,window.config.category){var o=this.components.scope.offsetWidth,s=this.components.scope.offsetHeight,a=(this.components.canvas.width-o)/2,c=(this.components.canvas.height-s)/2,u={left:a,top:c,right:a+o,bottom:c+s};this.objectSensor=new I(u,this.semanticShape,this.semanticScene,window.config.category)}n.canvas.onmousedown=function(t){i.handleMouseDown(t)}}this.components.radar&&(this.radarEnabled=!0,this.radarCtx=n.radar.getContext("2d")),this.actions=[{name:"moveForward",key:"w"},{name:"turnLeft",key:"a"},{name:"turnRight",key:"d"},{name:"lookUp",key:"ArrowUp"},{name:"lookDown",key:"ArrowDown"},{name:"addPrimitiveObject",key:"8"},{name:"addTemplateObject",key:"o"},{name:"removeLastObject",key:"9"},{name:"grabReleaseObject",key:"h"}]}return s()(t,[{key:"handleMouseDown",value:function(t){var e=this.semanticShape.get(0),n=this.semanticShape.get(1),i=e-1-t.offsetY,r=t.offsetX,o=this.semanticData[n*i+r];this.setStatus(this.semanticObjects.get(o).category.getName(""))}},{key:"init",value:function(){this.bindKeys()}},{key:"reset",value:function(){this.sim.reset(),this.setStatus("Ready"),this.render()}},{key:"setStatus",value:function(t){this.components.status.style="color:white",this.components.status.innerHTML=t}},{key:"setErrorStatus",value:function(t){this.components.status.style="color:red",this.components.status.innerHTML=t}},{key:"setWarningStatus",value:function(t){this.components.status.style="color:orange",this.components.status.innerHTML=t}},{key:"setSuccessStatus",value:function(t){this.components.status.style="color:green",this.components.status.innerHTML=t}},{key:"renderImage",value:function(){this.sim.displayObservation("rgb"),this.renderRadar()}},{key:"renderSemanticImage",value:function(){if(this.semanticsEnabled&&0!=this.semanticObjects.size()){this.sim.getObservation("semantic",this.semanticObservation);var t=this.semanticObservation.getData(),e=new Uint32Array(t.buffer,t.byteOffset,t.length/4);this.semanticData=e;for(var n=0;n<e.length;n++){var i=e[n];this.semanticImageData.data[4*n]=1&i?255:0,this.semanticImageData.data[4*n+1]=2&i?255:0,this.semanticImageData.data[4*n+2]=4&i?255:0,this.semanticImageData.data[4*n+3]=255}this.semanticCtx.putImageData(this.semanticImageData,0,0)}}},{key:"renderTopDown",value:function(t){t.renderTopDown&&null!==this.topdown&&this.topdown.moveTo(this.sim.getAgentState().position,500)}},{key:"renderRadar",value:function(){if(this.radarEnabled){var t,e,n=this.radarCtx;n.clearRect(0,0,100,100),n.globalAlpha=.5,n.fillStyle="darkslategray",n.arc(50,50,50,0,2*Math.PI),n.fill(),n.fillStyle="darkgray",n.beginPath(),n.arc(50,50,50,3*-Math.PI/4,-Math.PI/4),n.lineTo(50,50),n.closePath(),n.fill(),n.globalAlpha=1,n.beginPath();var i=this.sim.distanceToGoal(),r=g()(i,2);t=r[0],e=r[1];var o=t/(t+1),s=50+50*Math.sin(e)*o,a=50-50*Math.cos(e)*o;n.fillStyle="maroon",n.arc(s,a,3,0,2*Math.PI),n.fill()}}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{renderTopDown:!0};this.renderImage(),this.sim.updateCrossHairNode(this.sim.getCrosshairPosition()),this.sim.syncObjects(),this.renderImage(),this.renderSemanticImage(),this.renderTopDown(t)}},{key:"handleAction",value:function(t){"addPrimitiveObject"===t?this.sim.addPrimitiveObject():"addTemplateObject"===t?this.sim.addTemplateObject():"removeLastObject"===t?this.sim.removeLastObject():"grabReleaseObject"==t?this.sim.grabReleaseObject():this.sim.step(t),this.setStatus(t),this.render()}},{key:"bindKeys",value:function(){var t=this;document.addEventListener("keydown",(function(e){if(" "===e.key&&t.objectSensor){e.preventDefault();var n=t.objectSensor.computeIOU(t.semanticData);n>.5*parseFloat(window.config.iou)?t.setSuccessStatus("You found the "+window.config.category+"!"):n>0?t.setWarningStatus("IoU is too low. Please get a better view."):t.setErrorStatus(window.config.category+" not found!")}else{var i,r=C(t.actions);try{for(r.s();!(i=r.n()).done;){var o=i.value;if(e.key===o.key){t.handleAction(o.name),e.preventDefault();break}}}catch(t){r.e(t)}finally{r.f()}}}),!0)}}]),t}();function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var _=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"canvas";r()(this,t),c()(this,"currentResolution",h),this.canvasId=e}return s()(t,[{key:"initializeModules",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.sceneConfig=new Module.SceneConfiguration,this.sceneConfig.id=Module.scene,this.config=new Module.SimulatorConfiguration,this.config.scene=this.sceneConfig,this.config.enablePhysics=Module.enablePhysics,this.config.physicsConfigFile=Module.physicsConfigFile,this.simenv=new T(this.config,e,0),t=this.updateAgentConfigWithSensors(D({},t)),this.simenv.addAgent(t),this.simenv.updateCrossHairNode(this.simenv.resolution),this.topdown=n?new x(this.simenv.getPathFinder(),document.getElementById("topdown")):null,this.canvasElement=document.getElementById(this.canvasId),this.task=new R(this.simenv,{topdown:this.topdown,canvas:this.canvasElement,semantic:document.getElementById("semantic"),radar:document.getElementById("radar"),scope:document.getElementById("scope"),status:document.getElementById("status")})}},{key:"updateAgentConfigWithSensors",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,e=[{uuid:"rgb",sensorType:Module.SensorType.COLOR,resolution:[480,640]},{uuid:"semantic",sensorType:Module.SensorType.SEMANTIC,resolution:[480,640],channels:1}];return t.sensorSpecifications=e,t=this.updateAgentConfigWithResolution(t)}},{key:"resetCanvas",value:function(t){this.canvasElement.width=t.width,this.canvasElement.height=t.height}},{key:"updateAgentConfigWithResolution",value:function(t){var e=this;return t.sensorSpecifications.forEach((function(t){t.resolution=[e.currentResolution.height,e.currentResolution.width]})),t}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=O();n.useDefaultEpisode&&(e=l),this.initializeModules(t,e),this.task.init(),this.task.reset()}}]),t}(),F=n(0),N=n.n(F),V=n(6),W=n.n(V),z=n(7),H=n.n(z),L=n(8),U=n.n(L),B=n(5),Y=n.n(B);function G(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Y()(t);if(e){var r=Y()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return U()(this,n)}}var q=function(t){H()(n,t);var e=G(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"canvas",o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fps";return r()(this,n),t=e.call(this),c()(N()(t),"normalSceneFrame",void 0),c()(N()(t),"vrSceneFrame",void 0),c()(N()(t),"fpsElement",void 0),c()(N()(t),"lastPaintTime",void 0),c()(N()(t),"frameData",new VRFrameData),c()(N()(t),"previousRotation",!1),c()(N()(t),"previousPosition",!1),c()(N()(t),"currentVrDisplay",!1),c()(N()(t),"fps",0),c()(N()(t),"skipFrames",60),c()(N()(t),"currentFramesSkipped",0),t.canvasElement=document.getElementById(i),t.fpsElement=document.getElementById(o),t}return s()(n,[{key:"display",value:function(){this.setUpVR()}},{key:"initializeModules",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];W()(Y()(n.prototype),"initializeModules",this).call(this,t,e,i)}},{key:"setUpVR",value:function(){var t=this;navigator.getVRDisplays().then((function(e){e.length>0?t.setupDisplay(e[0]):(console.log("VR display not supported by this device"),W()(Y()(n.prototype),"display",t).call(t))}))}},{key:"setupDisplay",value:function(t){var e=this;this.currentVrDisplay=t,this.currentVrDisplay.requestPresent([{source:this.canvasElement}]).then((function(){return e.setupCanvas()})).then((function(){return e.initializeModules()})).then((function(){return e.renderDisplay()}))}},{key:"renderDisplay",value:function(){this.task.reset(),this.drawVRScene()}},{key:"setupCanvas",value:function(){var t=this.currentVrDisplay.getEyeParameters("left"),e=this.currentVrDisplay.getEyeParameters("right"),n=2*Math.max(t.renderWidth,e.renderWidth),i=Math.max(t.renderHeight,e.renderHeight);this.currentResolution={height:i,width:n},this.resetCanvas(this.currentResolution)}},{key:"drawVRScene",value:function(){this.vrSceneFrame=this.currentVrDisplay.requestAnimationFrame(this.drawVRScene.bind(this)),this.currentVrDisplay.getFrameData(this.frameData),this.updateAgentState(),this.task.render({renderTopDown:!1}),this.currentVrDisplay.submitFrame(),this.updateFPS()}},{key:"updateAgentState",value:function(){var t=this,e=this.simenv.sim.getAgent(this.simenv.selectedAgentId),n=this.simenv.createAgentState({});e.getState(n);var i=n.rotation.slice(),r=n.position.slice();if(this.previousRotation){var o=this.frameData.pose.orientation,s=this.frameData.pose.position;o.forEach((function(e,n){i[n]+=e-t.previousRotation[n]})),s.forEach((function(e,n){r[n]+=e-t.previousPosition[n]})),this.previousRotation=o.slice(),this.previousPosition=s.slice()}else this.previousRotation=this.frameData.pose.orientation.slice(),this.previousPosition=this.frameData.pose.position.slice();var a={position:r,rotation:i};a=this.simenv.createAgentState(a),e.setState(a,!0)}},{key:"updateFPS",value:function(){if(this.currentFramesSkipped==this.skipFrames)if(this.currentFramesSkipped=0,this.lastPaintTime){var t=performance.now(),e=(t-this.lastPaintTime)/1e3;this.fps=this.skipFrames/e,this.lastPaintTime=t,this.fpsElement.innerHTML="FPS: ".concat(this.fps.toFixed(2))}else this.lastPaintTime=performance.now();else this.currentFramesSkipped++}}]),n}(_);n(19);function $(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Y()(t);if(e){var r=Y()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return U()(this,n)}}var K=function(t){H()(n,t);var e=$(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"canvas";return r()(this,n),(t=e.call(this,i)).canvasElement=document.getElementById(i),window.addEventListener("resize",t.windowResizeEvent.bind(N()(t))),t}return s()(n,[{key:"initializeModules",value:function(){for(var t,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];3===i.length?i[2]=!1:2==i.length&&i.push(!1),(t=W()(Y()(n.prototype),"initializeModules",this)).call.apply(t,[this].concat(i))}},{key:"resetCanvasToCurrent",value:function(){this.currentResolution={height:this.canvasElement.offsetHeight,width:this.canvasElement.offsetWidth},this.resetCanvas(this.currentResolution)}},{key:"display",value:function(){this.resetCanvasToCurrent(),W()(Y()(n.prototype),"display",this).call(this)}},{key:"windowResizeEvent",value:function(){}}]),n}(_);n(21);function J(t){var e=t;if(0===t.indexOf("http")){var n=t.split("/");e=n[n.length-1]}return FS.createPreloadedFile("/",e,t,!0,!1),e}Module.preRun.push((function(){var t={};t.scene=f,O(t),window.config=t;var e=t.scene;Module.scene=J(e);var n=window.config.defaultPhysConfig;Module.physicsConfigFile=function(t){FS.mkdir("/data");var e=t;if(0===t.indexOf("http")){var n=t.split("/");e=n[n.length-1]}FS.createPreloadedFile("/data",e,"data/".concat(t),!0,!1);var i="/data".concat("/objects");FS.mkdir(i);var r=v;for(var o in r){var s=r[o].objectName,a=r[o].objectHandle,c=r[o].physicsProperties,u=r[o].renderMesh;FS.createPreloadedFile(i,s,"data/".concat(u),!0,!1),FS.createPreloadedFile(i,a,"data/".concat(c),!0,!1)}return"/data".concat("/".concat(e))}(n),Module.enablePhysics="true"===window.config.enablePhysics;var i=e.substr(0,e.lastIndexOf("."));J(i+".navmesh"),"mp3d"===t.semantic?(J(i+".house"),J(i+"_semantic.ply")):"replica"===t.semantic&&J(function(t){var e=t.split("/"),n=e.length>1;e.pop();var i="info_semantic.json";return n&&(i="/"+i),e.join("/")+i}(t.scene))})),Module.onRuntimeInitialized=function(){var t;console.log("hsim_bindings initialized"),window.vrEnabled?navigator&&navigator.getVRDisplays&&(console.log("Web VR is supported"),t=new q):window.viewerEnabled&&(t=new K),t||(t=new _),t.display()},function(){var t=function(){var t,e,n=!1;try{e=(t=document.createElement("canvas")).getContext("webgl")||t.getContext("experimental-webgl")}catch(t){return}return void 0!==e&&(n=!0),t=void 0,n?2:"undefined"!=typeof WebGL2RenderingContext?1:0}(),e="";if(t?1===t&&(e="WebGL2 is supported on your browser, but not enabled. "):e="WebGL2 is not supported on your browser. ",function(){try{if("object"===("undefined"==typeof WebAssembly?"undefined":b()(WebAssembly))&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){return!1}return!1}()||(e+="Web Assembly is not supported in your browser"),e.length>0){var n=document.getElementById("warning");n.innerHTML=e,n.className=""}}()}]);
//# sourceMappingURL=bundle.js.map