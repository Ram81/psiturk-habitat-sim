!function(t){var e={};function s(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=t,s.c=e,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(n,o,function(e){return t[e]}.bind(null,o));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=23)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function s(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){t.exports=function(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}},function(t,e,s){var n=s(12),o=s(13),i=s(14),a=s(16);t.exports=function(t,e){return n(t)||o(t,e)||i(t,e)||a()}},function(t,e){function s(e){return t.exports=s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},s(e)}t.exports=s},function(t,e,s){var n=s(17);function o(e,s,i){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=o=Reflect.get:t.exports=o=function(t,e,s){var o=n(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(s):i.value}},o(e,s,i||e)}t.exports=o},function(t,e,s){var n=s(18);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e,s){var n=s(9),o=s(2);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?o(t):e}},function(t,e){function s(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=s=function(t){return typeof t}:t.exports=s=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(e)}t.exports=s},function(t,e,s){"use strict";var n,o=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},i=function(){var t={};return function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}t[e]=s}return t[e]}}(),a=[];function r(t){for(var e=-1,s=0;s<a.length;s++)if(a[s].identifier===t){e=s;break}return e}function c(t,e){for(var s={},n=[],o=0;o<t.length;o++){var i=t[o],c=e.base?i[0]+e.base:i[0],l=s[c]||0,u="".concat(c," ").concat(l);s[c]=l+1;var d=r(u),h={css:i[1],media:i[2],sourceMap:i[3]};-1!==d?(a[d].references++,a[d].updater(h)):a.push({identifier:u,updater:g(h,e),references:1}),n.push(u)}return n}function l(t){var e=document.createElement("style"),n=t.attributes||{};if(void 0===n.nonce){var o=s.nc;o&&(n.nonce=o)}if(Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),"function"==typeof t.insert)t.insert(e);else{var a=i(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var u,d=(u=[],function(t,e){return u[t]=e,u.filter(Boolean).join("\n")});function h(t,e,s,n){var o=s?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(t.styleSheet)t.styleSheet.cssText=d(e,o);else{var i=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(i,a[e]):t.appendChild(i)}}function b(t,e,s){var n=s.css,o=s.media,i=s.sourceMap;if(o?t.setAttribute("media",o):t.removeAttribute("media"),i&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var p=null,f=0;function g(t,e){var s,n,o;if(e.singleton){var i=f++;s=p||(p=l(e)),n=h.bind(null,s,i,!1),o=h.bind(null,s,i,!0)}else s=l(e),n=b.bind(null,s,e),o=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(s)};return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else o()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=o());var s=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<s.length;n++){var o=r(s[n]);a[o].references--}for(var i=c(t,e),l=0;l<s.length;l++){var u=r(s[l]);0===a[u].references&&(a[u].updater(),a.splice(u,1))}s=i}}}},function(t,e,s){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var s=function(t,e){var s=t[1]||"",n=t[3];if(!n)return s;if(e&&"function"==typeof btoa){var o=(a=n,r=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),"/*# ".concat(c," */")),i=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[s].concat(i).concat([o]).join("\n")}var a,r,c;return[s].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(s,"}"):s})).join("")},e.i=function(t,s,n){"string"==typeof t&&(t=[[null,t,""]]);var o={};if(n)for(var i=0;i<this.length;i++){var a=this[i][0];null!=a&&(o[a]=!0)}for(var r=0;r<t.length;r++){var c=[].concat(t[r]);n&&o[c[0]]||(s&&(c[2]?c[2]="".concat(s," and ").concat(c[2]):c[2]=s),e.push(c))}},e}},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var s=[],n=!0,o=!1,i=void 0;try{for(var a,r=t[Symbol.iterator]();!(n=(a=r.next()).done)&&(s.push(a.value),!e||s.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw i}}return s}}},function(t,e,s){var n=s(15);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(t,e):void 0}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=t[s];return n}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,s){var n=s(5);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},function(t,e){function s(e,n){return t.exports=s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(e,n)}t.exports=s},function(t,e,s){var n=s(10),o=s(20);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[t.i,o,""]]);var i={insert:"head",singleton:!1};n(o,i);t.exports=o.locals||{}},function(t,e,s){(e=s(11)(!1)).push([t.i,".viewer-canvas {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  left: 0;\n  overflow: hidden;\n}\n\n.hidden {\n  display: hidden;\n}\n\n.tooltip {\n  color: #fff;\n  background-color: #666;\n  line-height: 2;\n  border-radius: 2px;\n  top: 0;\n  padding-top: 3px;\n  padding-bottom: 3px;\n  position: absolute;\n  z-index: 100;\n  text-align: center;\n  width: 100%;\n}\n\n.mobile-warning {\n  position: absolute;\n  bottom: 5px;\n}\n",""]),t.exports=e},function(t,e,s){var n=s(10),o=s(22);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[t.i,o,""]]);var i={insert:"head",singleton:!1};n(o,i);t.exports=o.locals||{}},function(t,e,s){(e=s(11)(!1)).push([t.i,"/** Copyright (c) Facebook, Inc. and its affiliates.\n *  This source code is licensed under the MIT license found in the\n *  LICENSE file in the root directory of this source tree.\n */\n#radar {\n  position: absolute;\n  top: 70%;\n  left: 50%;\n  margin-left: -50px;\n  width: 100;\n  height: 100;\n  z-index: 9;\n  pointer-events: none;\n  visibility: hidden;\n}\n\n#scope {\n  position: absolute;\n  border-color: red;\n  border-style: dashed;\n  border-width: 5px;\n  opacity: 0.4;\n  top: 50%;\n  left: 50%;\n  margin-left: -160px;\n  margin-top: -120px;\n  width: 320px;\n  height: 240px;\n  z-index: 9;\n  pointer-events: none;\n}\n\n#fps {\n  text-align: right;\n  margin-left: auto;\n  margin-right: auto;\n  width: 800px;\n  font-size: 15pt;\n  font-family: monospace;\n}\n\n#warning {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  z-index: 100;\n  background-color: #fff;\n  color: #000;\n}\n\n.hidden {\n  display: none !important;\n}\n\n.inventory-center {\n  margin-top: 1.5em;\n  text-align: center;\n}\n",""]),t.exports=e},function(t,e,s){"use strict";s.r(e);var n=s(0),o=s.n(n),i=s(1),a=s.n(i),r=s(3),c=s.n(r),l={height:1.5,radius:.1,mass:32,linearAcceleration:20,angularAcceleration:4*Math.PI,linearFriction:.5,angularFriction:1,coefficientOfRestitution:0},u={startState:{position:[-4.94049,-2.63092,-7.57733],rotation:[0,.980792,0,.195056]},goal:{position:[2.2896811962127686,.11950381100177765,16.97636604309082]}},d={height:480,width:640},h=-1===window.location.href.indexOf("localhost")?"https://habitat-resources.s3.amazonaws.com/data/scene_datasets/habitat-test-scenes/skokloster-castle.glb":"skokloster-castle.glb",b=["cylinderSolid_rings_1_segments_12_halfLen_1_useTexCoords_false_useTangents_false_capEnds_true"],p={objects:[{object:"apple",objectIcon:"/data/test_assets/objects/apple.png",objectHandle:"/data/objects/apple.object_config.json",physicsProperties:"test_assets/objects/apple.object_config.json",renderMesh:"test_assets/objects/apple.glb"},{object:"banana",objectIcon:"/data/test_assets/objects/banana.png",objectHandle:"/data/objects/banana.object_config.json",physicsProperties:"test_assets/objects/banana.object_config.json",renderMesh:"test_assets/objects/banana.glb"},{object:"cracker box",objectIcon:"/data/test_assets/objects/cracker_box.png",objectHandle:"/data/objects/cracker_box.object_config.json",physicsProperties:"test_assets/objects/cracker_box.object_config.json",renderMesh:"test_assets/objects/cracker_box.glb"},{object:"colored wood blocks",objectIcon:"/data/test_assets/objects/colored_wood_blocks.png",objectHandle:"/data/objects/colored_wood_blocks.object_config.json",physicsProperties:"test_assets/objects/colored_wood_blocks.object_config.json",renderMesh:"test_assets/objects/colored_wood_blocks.glb"},{object:"gelatin box",objectIcon:"/data/test_assets/objects/gelatin_box.png",objectHandle:"/data/objects/gelatin_box.object_config.json",physicsProperties:"test_assets/objects/gelatin_box.object_config.json",renderMesh:"test_assets/objects/gelatin_box.glb"},{object:"hammer",objectIcon:"/data/test_assets/objects/hammer.png",objectHandle:"/data/objects/hammer.object_config.json",physicsProperties:"test_assets/objects/hammer.object_config.json",renderMesh:"test_assets/objects/hammer.glb"},{object:"master chef can",objectIcon:"/data/test_assets/objects/master_chef_can.png",objectHandle:"/data/objects/master_chef_can.object_config.json",physicsProperties:"test_assets/objects/master_chef_can.object_config.json",renderMesh:"test_assets/objects/master_chef_can.glb"},{object:"soccer ball",objectIcon:"/data/test_assets/objects/mini_soccer_ball.png",objectHandle:"/data/objects/mini_soccer_ball.object_config.json",physicsProperties:"test_assets/objects/mini_soccer_ball.object_config.json",renderMesh:"test_assets/objects/mini_soccer_ball.glb"},{object:"mustard bottle",objectIcon:"/data/test_assets/objects/mustard_bottle.png",objectHandle:"/data/objects/mustard_bottle.object_config.json",physicsProperties:"test_assets/objects/mustard_bottle.object_config.json",renderMesh:"test_assets/objects/mustard_bottle.glb"},{object:"orange",objectIcon:"/data/test_assets/objects/orange.png",objectHandle:"/data/objects/orange.object_config.json",physicsProperties:"test_assets/objects/orange.object_config.json",renderMesh:"test_assets/objects/orange.glb"},{object:"red bowl",objectIcon:"/data/test_assets/objects/bowl.png",objectHandle:"/data/objects/bowl.object_config.json",physicsProperties:"test_assets/objects/bowl.object_config.json",renderMesh:"test_assets/objects/bowl.glb"},{object:"red mug",objectIcon:"/data/test_assets/objects/mug.png",objectHandle:"/data/objects/mug.object_config.json",physicsProperties:"test_assets/objects/mug.object_config.json",renderMesh:"test_assets/objects/mug.glb"},{object:"red plate",objectIcon:"/data/test_assets/objects/plate.png",objectHandle:"/data/objects/plate.object_config.json",physicsProperties:"test_assets/objects/plate.object_config.json",renderMesh:"test_assets/objects/plate.glb"},{object:"red sphere",objectIcon:"/data/test_assets/objects/sphere.png",objectHandle:"/data/objects/sphere.object_config.json",physicsProperties:"test_assets/objects/sphere.object_config.json",renderMesh:"test_assets/objects/sphere.glb"},{object:"tomato soup can",objectIcon:"/data/test_assets/objects/tomato_soup_can.png",objectHandle:"/data/objects/tomato_soup_can.object_config.json",physicsProperties:"test_assets/objects/tomato_soup_can.object_config.json",renderMesh:"test_assets/objects/tomato_soup_can.glb"},{object:"toy airplane",objectIcon:"/data/test_assets/objects/toy_airplane.png",objectHandle:"/data/objects/toy_airplane.object_config.json",physicsProperties:"test_assets/objects/toy_airplane.object_config.json",renderMesh:"test_assets/objects/toy_airplane.glb"},{object:"wood block",objectIcon:"/data/test_assets/objects/wood_block.png",objectHandle:"/data/objects/wood_block.object_config.json",physicsProperties:"test_assets/objects/wood_block.object_config.json",renderMesh:"test_assets/objects/wood_block.glb"},{object:"large clamp",objectIcon:"/data/test_assets/objects/large_clamp.png",objectHandle:"/data/objects/large_clamp.object_config.json",physicsProperties:"test_assets/objects/large_clamp.object_config.json",renderMesh:"test_assets/objects/large_clamp.glb"},{object:"blue cup",objectIcon:"/data/test_assets/objects/b_cups.png",objectHandle:"/data/objects/b_cups.object_config.json",physicsProperties:"test_assets/objects/b_cups.object_config.json",renderMesh:"test_assets/objects/b_cups.glb"},{object:"green cup",objectIcon:"/data/test_assets/objects/c_cups.png",objectHandle:"/data/objects/c_cups.object_config.json",physicsProperties:"test_assets/objects/c_cups.object_config.json",renderMesh:"test_assets/objects/c_cups.glb"},{object:"baseball",objectIcon:"/data/test_assets/objects/baseball.png",objectHandle:"/data/objects/baseball.object_config.json",physicsProperties:"test_assets/objects/baseball.object_config.json",renderMesh:"test_assets/objects/baseball.glb"},{object:"tennis ball",objectIcon:"/data/test_assets/objects/tennis_ball.png",objectHandle:"/data/objects/tennis_ball.object_config.json",physicsProperties:"test_assets/objects/tennis_ball.object_config.json",renderMesh:"test_assets/objects/tennis_ball.glb"},{object:"blue jug",objectIcon:"/data/test_assets/objects/pitcher_base.png",objectHandle:"/data/objects/pitcher_base.object_config.json",physicsProperties:"test_assets/objects/pitcher_base.object_config.json",renderMesh:"test_assets/objects/pitcher_base.glb"},{object:"potted meat can",objectIcon:"/data/test_assets/objects/potted_meat_can.png",objectHandle:"/data/objects/potted_meat_can.object_config.json",physicsProperties:"test_assets/objects/potted_meat_can.object_config.json",renderMesh:"test_assets/objects/potted_meat_can.glb"},{object:"sugar box",objectIcon:"/data/test_assets/objects/sugar_box.png",objectHandle:"/data/objects/sugar_box.object_config.json",physicsProperties:"test_assets/objects/sugar_box.object_config.json",renderMesh:"test_assets/objects/sugar_box.glb"},{object:"rubiks cube",objectIcon:"/data/test_assets/objects/rubiks_cube.png",objectHandle:"/data/objects/rubiks_cube.object_config.json",physicsProperties:"test_assets/objects/rubiks_cube.object_config.json",renderMesh:"test_assets/objects/rubiks_cube.glb"},{object:"softball",objectIcon:"/data/test_assets/objects/softball.png",objectHandle:"/data/objects/softball.object_config.json",physicsProperties:"test_assets/objects/softball.object_config.json",renderMesh:"test_assets/objects/softball.glb"},{object:"plum",objectIcon:"/data/test_assets/objects/plum.png",objectHandle:"/data/objects/plum.object_config.json",physicsProperties:"test_assets/objects/plum.object_config.json",renderMesh:"test_assets/objects/plum.glb"},{object:"spoon",objectIcon:"/data/test_assets/objects/spoon.png",objectHandle:"/data/objects/spoon.object_config.json",physicsProperties:"test_assets/objects/spoon.object_config.json",renderMesh:"test_assets/objects/spoon.glb"},{object:"blue wood block",objectIcon:"/data/test_assets/objects/b_colored_wood_blocks.png",objectHandle:"/data/objects/b_colored_wood_blocks.object_config.json",physicsProperties:"test_assets/objects/b_colored_wood_blocks.object_config.json",renderMesh:"test_assets/objects/b_colored_wood_blocks.glb"},{object:"fork",objectIcon:"/data/test_assets/objects/fork.png",objectHandle:"/data/objects/fork.object_config.json",physicsProperties:"test_assets/objects/fork.object_config.json",renderMesh:"test_assets/objects/fork.glb"},{object:"knife",objectIcon:"/data/test_assets/objects/knife.png",objectHandle:"/data/objects/knife.object_config.json",physicsProperties:"test_assets/objects/knife.object_config.json",renderMesh:"test_assets/objects/knife.glb"},{object:"red cup",objectIcon:"/data/test_assets/objects/e_cups.png",objectHandle:"/data/objects/e_cups.object_config.json",physicsProperties:"test_assets/objects/e_cups.object_config.json",renderMesh:"test_assets/objects/e_cups.glb"},{object:"yellow cup",objectIcon:"/data/test_assets/objects/d_cups.png",objectHandle:"/data/objects/d_cups.object_config.json",physicsProperties:"test_assets/objects/d_cups.object_config.json",renderMesh:"test_assets/objects/d_cups.glb"},{object:"toy gun",objectIcon:"/data/test_assets/objects/b_toy_airplane.png",objectHandle:"/data/objects/b_toy_airplane.object_config.json",physicsProperties:"test_assets/objects/b_toy_airplane.object_config.json",renderMesh:"test_assets/objects/b_toy_airplane.glb"},{object:"screwdriver",objectIcon:"/data/test_assets/objects/phillips_screwdriver.png",objectHandle:"/data/objects/phillips_screwdriver.object_config.json",physicsProperties:"test_assets/objects/phillips_screwdriver.object_config.json",renderMesh:"test_assets/objects/phillips_screwdriver.glb"},{object:"brown box",objectIcon:"/data/test_assets/objects/foam_brick.png",objectHandle:"/data/objects/foam_brick.object_config.json",physicsProperties:"test_assets/objects/foam_brick.object_config.json",renderMesh:"test_assets/objects/foam_brick.glb"},{object:"purple lego",objectIcon:"/data/test_assets/objects/b_lego_duplo.png",objectHandle:"/data/objects/b_lego_duplo.object_config.json",physicsProperties:"test_assets/objects/b_lego_duplo.object_config.json",renderMesh:"test_assets/objects/b_lego_duplo.glb"},{object:"blue lego",objectIcon:"/data/test_assets/objects/e_lego_duplo.png",objectHandle:"/data/objects/e_lego_duplo.object_config.json",physicsProperties:"test_assets/objects/e_lego_duplo.object_config.json",renderMesh:"test_assets/objects/e_lego_duplo.glb"},{object:"spatula",objectIcon:"/data/test_assets/objects/spatula.png",objectHandle:"/data/objects/spatula.object_config.json",physicsProperties:"test_assets/objects/spatula.object_config.json",renderMesh:"test_assets/objects/spatula.glb"},{object:"wrench",objectIcon:"/data/test_assets/objects/adjustable_wrench.png",objectHandle:"/data/objects/adjustable_wrench.object_config.json",physicsProperties:"test_assets/objects/adjustable_wrench.object_config.json",renderMesh:"test_assets/objects/adjustable_wrench.glb"},{object:"orange cup",objectIcon:"/data/test_assets/objects/a_cups.png",objectHandle:"/data/objects/a_cups.object_config.json",physicsProperties:"test_assets/objects/a_cups.object_config.json",renderMesh:"test_assets/objects/a_cups.glb"},{object:"tuna fish can",objectIcon:"/data/test_assets/objects/tuna_fish_can.png",objectHandle:"/data/objects/tuna_fish_can.object_config.json",physicsProperties:"test_assets/objects/tuna_fish_can.object_config.json",renderMesh:"test_assets/objects/tuna_fish_can.glb"},{object:"power drill",objectIcon:"/data/test_assets/objects/power_drill.png",objectHandle:"/data/objects/power_drill.object_config.json",physicsProperties:"test_assets/objects/power_drill.object_config.json",renderMesh:"test_assets/objects/power_drill.glb"},{object:"green lego",objectIcon:"/data/test_assets/objects/a_lego_duplo.png",objectHandle:"/data/objects/a_lego_duplo.object_config.json",physicsProperties:"test_assets/objects/a_lego_duplo.object_config.json",renderMesh:"test_assets/objects/a_lego_duplo.glb"},{object:"purple cup",objectIcon:"/data/test_assets/objects/f_cups.png",objectHandle:"/data/objects/f_cups.object_config.json",physicsProperties:"test_assets/objects/f_cups.object_config.json",renderMesh:"test_assets/objects/f_cups.glb"},{object:"pear",objectIcon:"/data/test_assets/objects/pear.png",objectHandle:"/data/objects/pear.object_config.json",physicsProperties:"test_assets/objects/pear.object_config.json",renderMesh:"test_assets/objects/pear.glb"},{object:"racquetball",objectIcon:"/data/test_assets/objects/racquetball.png",objectHandle:"/data/objects/racquetball.object_config.json",physicsProperties:"test_assets/objects/racquetball.object_config.json",renderMesh:"test_assets/objects/racquetball.glb"},{object:"scissors",objectIcon:"/data/test_assets/objects/scissors.png",objectHandle:"/data/objects/scissors.object_config.json",physicsProperties:"test_assets/objects/scissors.object_config.json",renderMesh:"test_assets/objects/scissors.glb"},{object:"white bottle",objectIcon:"/data/test_assets/objects/bleach_cleanser.png",objectHandle:"/data/objects/bleach_cleanser.object_config.json",physicsProperties:"test_assets/objects/bleach_cleanser.object_config.json",renderMesh:"test_assets/objects/bleach_cleanser.glb"}]},f={name:"replay_task_1.json",config:"tasks/replay_task_1.json"},g={name:"replay_task_1.csv",location:"replays/replay_task_1.csv"},j={tasks:[{name:"task_3.json",config:"tasks/task_3.json",scene:"empty_house.glb",flythroughTask:{name:"replay_task_3.json",config:"tasks/replay_task_3.json"},flythroughReplayFile:{name:"replay_task_3.csv",location:"replays/replay_task_3.csv"},trainingTask:{name:"training_task_3.json",config:"tasks/training_task_3.json"}},{name:"task_4.json",config:"tasks/task_4.json",scene:"empty_house.glb",flythroughTask:{name:"replay_task_3.json",config:"tasks/replay_task_3.json"},flythroughReplayFile:{name:"replay_task_3.csv",location:"replays/replay_task_3.csv"},trainingTask:{name:"training_task_3.json",config:"tasks/training_task_3.json"}},{name:"task_5.json",config:"tasks/task_5.json",scene:"big_house.glb",flythroughTask:{name:"replay_task_3.json",config:"tasks/replay_task_3.json"},flythroughReplayFile:{name:"replay_task_3.csv",location:"replays/replay_task_3.csv"},trainingTask:{name:"training_task_5.json",config:"tasks/training_task_5.json"}},{name:"task_7.json",config:"tasks/task_7.json",scene:"big_house_2.glb",flythroughTask:{name:"replay_task_3.json",config:"tasks/replay_task_3.json"},flythroughReplayFile:{name:"replay_task_3.csv",location:"replays/replay_task_3.csv"},trainingTask:{name:"training_task_7.json",config:"tasks/training_task_7.json"}},{name:"task_8.json",config:"tasks/task_8.json",scene:"house_3.glb",flythroughTask:{name:"replay_task_3.json",config:"tasks/replay_task_3.json"},flythroughReplayFile:{name:"replay_task_3.csv",location:"replays/replay_task_3.csv"},trainingTask:{name:"training_task_8.json",config:"tasks/training_task_8.json"}}]},v=s(4),y=s.n(v),m=s(9),_=s.n(m);function k(t,e){var s;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(s=function(t,e){if(!t)return;if("string"==typeof t)return w(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return w(t,e)}(t))||e&&t&&"number"==typeof t.length){s&&(t=s);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,r=!1;return{s:function(){s=t[Symbol.iterator]()},n:function(){var t=s.next();return a=t.done,t},e:function(t){r=!0,i=t},f:function(){try{a||null==s.return||s.return()}finally{if(r)throw i}}}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=t[s];return n}function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,s=!1;return function(){var n=arguments,o=this;s||(t.apply(o,n),s=!0,window.setTimeout((function(){s=!1}),e))}}function I(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=k(window.location.search.substr(1).split("&"));try{for(s.s();!(t=s.n()).done;){var n=t.value,o=n.split("="),i=y()(o,2),a=i[0],r=i[1];a&&r&&(e[a]=decodeURIComponent(r))}}catch(t){s.e(t)}finally{s.f()}return e}function S(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return Math.floor(Math.random()*t)}function T(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{encoding:"utf8"},s=FS.readFile(t,{encoding:e.encoding}),n=JSON.parse(s);return n}function M(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"task.json",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",s=T(t),n={startState:{}};return n.episodeID=e,n.startState.position=s.episodes[e].start_position,n.startState.rotation=s.episodes[e].start_rotation,n.sceneID=s.episodes[e].scene_id,n.objects=s.episodes[e].objects,n.task=s.episodes[e].task,n}function P(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";return void 0===t?u:void 0===e?M(t):M(t,e)}var A=function(){function t(e){o()(this,t),this.psiturk=e}return a()(t,[{key:"handleRecordTrialData",value:function(t,e,s){this.psiturk&&0==window.config.disableLogging&&this.psiturk.recordTrialData({phase:t,event:e,data:s})}},{key:"handleRecordUnstructuredData",value:function(t,e){this.psiturk&&0==window.config.disableLogging&&this.psiturk.recordUnstructuredData(t,e)}}]),t}();function C(t,e){var s;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(s=function(t,e){if(!t)return;if("string"==typeof t)return x(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return x(t,e)}(t))||e&&t&&"number"==typeof t.length){s&&(t=s);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,r=!1;return{s:function(){s=t[Symbol.iterator]()},n:function(){var t=s.next();return a=t.done,t},e:function(t){r=!0,i=t},f:function(){try{a||null==s.return||s.return()}finally{if(r)throw i}}}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=t[s];return n}var D=function(){function t(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;o()(this,t),this.sim=new Module.Simulator(e),this.pathfinder=this.sim.getPathFinder(),this.psiturk=new A(window.psiTurk),this.resolution=null,this.grippedObjectId=-1,this.nearestObjectId=-1,this.gripOffset=null,this.selectedAgentId=n,this.agentObjectHandle=b[0],this.setEpisode(s),window.config.recomputeNavMesh&&this.recomputeNavMesh(),this.maxDistance=2}return a()(t,[{key:"reset",value:function(){(this.sim.reset(),null!==this.initialAgentState)&&this.sim.getAgent(this.selectedAgentId).setState(this.initialAgentState,!0);this.updateCrossHairNode(this.getCrosshairPosition()),this.grippedObjectId=-1,this.nearestObjectId=-1,this.gripOffset=null,this.psiturk.handleRecordTrialData("TEST","simReset",{})}},{key:"changeAgent",value:function(t){this.selectedAgentId=t}},{key:"setEpisode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.removeAllObjects(),this.episode=t,this.initialAgentState=null,this.objectsInScene=[],Object.keys(t).length>0){this.initialAgentState=this.createAgentState(t.startState),this.sim.addContactTestObject(this.agentObjectHandle,0);var e=JSON.parse(JSON.stringify(t.objects));for(var s in e.sort((function(t,e){var s=t.objectId,n=e.objectId;return s<n?-1:s>n?1:0})),e){var n=e[s].objectHandle,o=this.convertVec3fToVector3(e[s].position),i=this.quatFromCoeffs(e[s].rotation),a=this.addObjectAtLocation(n,o,i);this.addObjectInScene(a,e[s]),this.sim.addContactTestObject(n,0),t.objects[s].simObjectId=a,t.objects[s].prevObjectId=t.objects[s].objectId,t.objects[s].objectId=a}}else this.sim.addContactTestObject(this.agentObjectHandle,0);this.psiturk.handleRecordTrialData("TEST","setEpisode",{episode:t})}},{key:"updateCrossHairNode",value:function(t){this.sim.updateCrossHairNode(t)}},{key:"addObjectInScene",value:function(t,e){var s=JSON.parse(JSON.stringify(e));s.objectId=t,this.objectsInScene.push(s)}},{key:"updateObjectInScene",value:function(t,e){for(var s=0;s<this.objectsInScene.length;s++)if(this.objectsInScene[s].objectId==t){this.objectsInScene[s].objectId=e;break}}},{key:"getObjectFromScene",value:function(t){for(var e=0;e<this.objectsInScene.length;e++)if(this.objectsInScene[e].objectId==t)return this.objectsInScene[e];return null}},{key:"getObjectsInScene",value:function(){return this.objectsInScene}},{key:"syncObjects",value:function(){this.sim.syncGrippedObject(this.grippedObjectId)}},{key:"addObjectAtLocation",value:function(t,e,s){var n=this.addObjectByHandle(t);return this.setTranslation(e,n,0),this.setRotation(s,n,0),this.setObjectMotionType(Module.MotionType.DYNAMIC,n,0),n}},{key:"removeAllObjects",value:function(){for(var t=this.getExistingObjectIDs(),e=t.size()-1;e>=0;e--){var s=t.get(e),n=this.getObjectFromScene(s);this.removeObject(s),this.sim.removeContactTestObject(n.objectHandle,0)}this.sim.clearRecycledObjectIds()}},{key:"step",value:function(t){var e=this.sim.getAgent(this.selectedAgentId),s=this.getAgentTransformation(this.selectedAgentId);return!!this.isAgentColliding(t,s).collision||(e.act(t),!1)}},{key:"addAgent",value:function(t){var e=this.createAgentConfig(t);return this.resolution=this.flipVec2i(e.sensorSpecifications.get(0).resolution),this.sim.addAgent(e)}},{key:"addObject",value:function(t){return this.sim.addObject(t,null,"",0)}},{key:"removeObject",value:function(t){this.sim.removeObject(t,!0,!0,0)}},{key:"addObjectByHandle",value:function(t){return this.sim.addObjectByHandle(t,null,"",0)}},{key:"addPrimitiveObject",value:function(){var t=S(b.length),e=b[t],s=this.addObjectByHandle(e),n=this.getAgentTransformation(0).transformPoint(new Module.Vector3(.1,1.5,-1.5));return this.setTranslation(n,s,0),s}},{key:"addTemplateObject",value:function(){var t=S(p.objects.length),e=p.objects[t].objectHandle,s=this.addObjectByHandle(e),n=this.getAgentTransformation(0).transformPoint(new Module.Vector3(.1,1.5,-1.5));return this.setTranslation(n,s,0),this.addObjectInScene(s,p.objects[t]),this.sim.addContactTestObject(p.objects[t].objectHandle,0),s}},{key:"removeLastObject",value:function(){var t=this.getExistingObjectIDs();this.removeObject(t.get(t.size()-1))}},{key:"grabReleaseObject",value:function(){var t=this.getObjectUnderCrosshair(),e=this.getAgentTransformation(0);if(-1!=this.grippedObjectId){this.setTransformation(e.mul(this.gripOffset),this.grippedObjectId,0);var s=this.getTranslation(this.grippedObjectId,0);if(!this.pathfinder.isNavigable(this.convertVector3ToVec3f(s),.5))return void console.log("Colliding with object or position is not navigable");this.setObjectMotionType(Module.MotionType.STATIC,this.grippedObjectId,0),this.grippedObjectId=-1,this.drawBBAroundNearestObject()}else{if(-1==t)return;this.gripOffset=e.inverted().mul(this.getTransformation(t,0)),this.setObjectMotionType(Module.MotionType.KINEMATIC,t,0),this.grippedObjectId=t}this.recomputeNavMesh()}},{key:"inventoryGrabReleaseObject",value:function(){var t=this.getObjectUnderCrosshair().nearestObjectId,e=!1,s=!1,n={};if(-1!=this.grippedObjectId){s=!0;var o=this.findObjectFloorPositionUnderCrosshair(),i=this.getObjectFromScene(this.grippedObjectId),a=this.addObjectByHandle(i.objectHandle);this.setTranslation(o,a,0),this.setObjectMotionType(Module.MotionType.DYNAMIC,a,0),this.updateObjectInScene(this.grippedObjectId,a),n={newObjectTranslation:this.convertVector3ToVec3f(o),newObjectId:a,objectHandle:i.objectHandle,grippedObjectId:this.grippedObjectId},this.grippedObjectId=-1}else if(-1!=t){e=!0,this.grippedObjectTransformation=this.getTransformation(t,0),!0!==this.getObjectFromScene(t).isReceptacle&&(this.removeObject(t,0),this.grippedObjectId=t),n={grippedObjectId:this.grippedObjectId}}return{grabAction:e,releaseAction:s,objectUnderCrosshair:t,grippedObjectId:this.grippedObjectId,nearestObjectId:this.nearestObjectId,actionMeta:n}}},{key:"getObservationSpace",value:function(t){return this.sim.getAgentObservationSpace(this.selectedAgentId,t)}},{key:"getObservation",value:function(t,e){return this.sim.getAgentObservation(this.selectedAgentId,t,e),e}},{key:"getPathFinder",value:function(){return this.sim.getPathFinder()}},{key:"getObjectMotionType",value:function(t,e){return this.sim.getObjectMotionType(t,e)}},{key:"setObjectMotionType",value:function(t,e,s){return this.sim.setObjectMotionType(t,e,s)}},{key:"getExistingObjectIDs",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.sim.getExistingObjectIDs(t)}},{key:"setTransformation",value:function(t,e,s){this.sim.setTransformation(t,e,s)}},{key:"getTransformation",value:function(t,e){return this.sim.getTransformation(t,e)}},{key:"getTranslation",value:function(t,e){return this.sim.getTranslation(t,e)}},{key:"setTranslation",value:function(t,e,s){this.sim.setTranslation(t,e,s)}},{key:"getRotation",value:function(t,e){return this.sim.getRotation(t,e)}},{key:"setRotation",value:function(t,e,s){this.sim.setRotation(t,e,s)}},{key:"setObjectBBDraw",value:function(t,e,s){this.sim.setObjectBBDraw(t,e,s)}},{key:"stepWorld",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/60;return this.sim.stepWorld(t)}},{key:"getWorldTime",value:function(){return this.sim.getWorldTime()}},{key:"displayObservation",value:function(t){this.sim.displayObservation(0,t)}},{key:"getSemanticScene",value:function(){return this.sim.getSemanticScene()}},{key:"contactTest",value:function(t){return this.sim.contactTest(t,0)}},{key:"getAgent",value:function(t){return this.sim.getAgent(t)}},{key:"getAgentTransformation",value:function(t){return this.sim.getAgentTransformation(t)}},{key:"getAgentAbsoluteTranslation",value:function(t){return this.sim.getAgentAbsoluteTranslation(t)}},{key:"getAgentRotation",value:function(t){return this.sim.getAgentRotation(t)}},{key:"getAgentSensorSuite",value:function(t){return this.sim.getAgentSensorSuite(t)}},{key:"getAgentState",value:function(){var t=new Module.AgentState;return this.sim.getAgent(this.selectedAgentId).getState(t),t}},{key:"getCrosshairPosition",value:function(){return this.resolution.map((function(t){return.5*t}))}},{key:"getObjectUnderCrosshair",value:function(){var t=this.getCrosshairPosition(),e=this.unproject(t).direction,s=this.getAgentAbsoluteTranslation(0);return{nearestObjectId:this.findNearestObjectUnderCrosshair(e,s,this.resolution),crossHairPoint:this.convertVector3ToVec3f(e),refPoint:this.convertVector3ToVec3f(s),crossHairPosition:t}}},{key:"drawBBAroundNearestObject",value:function(){var t=this.getObjectUnderCrosshair().nearestObjectId;if(-1==t)-1!=this.nearestObjectId&&this.grippedObjectId!=this.nearestObjectId&&(this.setObjectBBDraw(!1,this.nearestObjectId,0),this.nearestObjectId=t);else{if(-1!=this.nearestObjectId&&this.grippedObjectId!=this.nearestObjectId&&(this.setObjectBBDraw(!1,this.nearestObjectId,0),this.nearestObjectId=-1),!0===this.getObjectFromScene(t).isReceptacle)return;this.nearestObjectId!=t&&(this.nearestObjectId=t,this.setObjectBBDraw(!0,this.nearestObjectId,0))}}},{key:"showDropPoint",value:function(){if(-1===this.grippedObjectId){var t=this.getAgentAbsoluteTranslation(0);t=new Module.Vector3(t.x(),t.y()-.5,t.z()),this.updateDropPointNode(t)}else{var e=this.findObjectFloorPositionUnderCrosshair();this.updateDropPointNode(e)}}},{key:"updateDropPointNode",value:function(t){this.sim.updateDropPointNode(t)}},{key:"findObjectFloorPositionUnderCrosshair",value:function(){var t=this.getCrosshairPosition(),e=this.unproject(t).direction,s=this.getAgentTransformation(0),n=this.sim.findFloorPositionUnderCrosshair(e,s,this.resolution,this.maxDistance).point;if(null==n)return!0;var o=n.y();this.grippedObjectTransformation.translation().y()>=o&&(o=this.grippedObjectTransformation.translation().y());for(var i=new Module.Vector3(n.x(),o,n.z()),a=this.getObjectFromScene(this.grippedObjectId),r=this.isCollision(a.objectHandle,i),c=0;r&&c<5;)i=new Module.Vector3(i.x(),i.y()+.25,i.z()),r=this.isCollision(a.objectHandle,i),c+=1;return i}},{key:"sampleObjectState",value:function(t,e){this.sim.sampleObjectState(t,e)}},{key:"recomputeNavMesh",value:function(){var t=new Module.NavMeshSettings;this.sim.recomputeNavMesh(this.getPathFinder(),t,!0)}},{key:"toggleNavMeshVisualization",value:function(){this.sim.setNavMeshVisualization(!0)}},{key:"findNearestObjectUnderCrosshair",value:function(t,e,s){return this.sim.findNearestObjectUnderCrosshair(t,e,s,this.maxDistance)}},{key:"unproject",value:function(t){return this.sim.unproject(t)}},{key:"isAgentColliding",value:function(t,e){if("moveForward"==t){var s=e.backward().mul(-.25),n=e.translation().add(s),o=this.pathfinder.tryStep(e.translation(),n).sub(n),i=n.add(o).add(new Module.Vector3(0,.05,0));return{collision:this.isCollision(this.agentObjectHandle,i,!0),position:i}}if("moveBackward"==t){var a=e.backward().mul(.25),r=e.translation().add(a),c=this.pathfinder.tryStep(e.translation(),r).sub(r),l=r.add(c).add(new Module.Vector3(0,.05,0));return{collision:this.isCollision(this.agentObjectHandle,l,!0),position:l}}return!1}},{key:"isCollision",value:function(t,e){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.sim.preAddContactTest(t,e,s,n)}},{key:"geodesicDistance",value:function(t,e){var s=new Module.ShortestPath;return s.requestedStart=t,s.requestedEnd=e,this.pathfinder.findPath(s),s.geodesicDistance}},{key:"getDistanceBetweenObjects",value:function(t,e){var s=this.getTranslation(t,0),n=this.getTranslation(e,0);return this.geodesicDistance(this.convertVector3ToVec3f(s),this.convertVector3ToVec3f(n))}},{key:"getObjectBBYCoord",value:function(t){return this.sim.getObjectBBYCoord(t)}},{key:"getNumActiveContactPoints",value:function(){return this.sim.getNumActiveContactPoints()}},{key:"getObjectStates",value:function(){for(var t=[],e=this.getExistingObjectIDs(),s=0;s<e.size();s++){var n=e.get(s),o=this.getTranslation(n,0),i=this.getRotation(n,0),a=this.getObjectMotionType(n,0).value,r=this.getObjectFromScene(n),c={objectId:n,translation:this.convertVector3ToVec3f(o),rotation:this.coeffFromQuat(i),motionType:a,objectHandle:r.objectHandle};t.push(c)}return t}},{key:"getAgentPose",value:function(){for(var t=this.getAgentTransformation(this.selectedAgentId).translation(),e=this.getAgentRotation(this.selectedAgentId),s=this.getAgentSensorSuite(this.selectedAgentId),n=s.keys(),o={},i=0;i<n.size();i++){var a=n.get(i),r=s.get(a).rotation(),c=s.get(a).translation();o[a]={rotation:this.coeffFromQuat(r),position:this.convertVector3ToVec3f(c)}}return{position:this.convertVector3ToVec3f(t),rotation:this.coeffFromQuat(e),sensorData:o}}},{key:"getObjectPose",value:function(){var t=this.getObjectUnderCrosshair().nearestObjectId,e=this.getTranslation(t,0),s=this.getRotation(t,0);console.log("object translation: "+this.convertVector3ToVec3f(e)),console.log("object rotation: "+this.coeffFromQuat(s))}},{key:"convertVector3ToVec3f",value:function(t){return[t.x(),t.y(),t.z()]}},{key:"convertVec3fToVector3",value:function(t){return new Module.Vector3(t[0],t[1],t[2])}},{key:"coeffFromQuat",value:function(t){var e=this.convertVector3ToVec3f(t.vector()).slice();return e.push(t.scalar()),e}},{key:"quatFromCoeffs",value:function(t){var e=this.convertVec3fToVector3(t.slice(0,3));return new Module.Quaternion(e,t[3])}},{key:"flipVec2i",value:function(t){return[t[1],t[0]]}},{key:"enableDebugDraw",value:function(){this.sim.enableDebugDraw()}},{key:"dropObjectFromFloor2",value:function(){console.log("dropping object");var t=[-4.202342510223389,1.101901888847351,-7.044765472412109];t=this.convertVec3fToVector3(t),this.setTranslation(t,0,0),this.sim.setActiveState(0,0)}},{key:"distanceToGoal",value:function(){if(0===Object.keys(this.episode).length||void 0===this.episode.goal)return[0,0];var t=this.episode.goal.position,e=this.getAgentState(),s=e.position,n=[t[0]-s[0],t[1]-s[1],t[2]-s[2]];return n=this.applyRotation(n,e.rotation),this.cartesian_to_polar(-n[2],n[0])}},{key:"applyRotation",value:function(t,e){var s,n,o,i,a,r,c,l=y()(t,3);s=l[0],n=l[1],o=l[2];var u=y()(e,4);i=u[0],a=u[1],r=u[2];var d=(c=u[3])*s-a*o+r*n,h=c*n-r*s+i*o,b=c*o-i*n+a*s,p=i*s+a*n+r*o,f=[];return f[0]=d*c+p*i+h*r-b*a,f[1]=h*c+p*a+b*i-d*r,f[2]=b*c+p*r+d*a-h*i,f}},{key:"cartesian_to_polar",value:function(t,e){return[Math.sqrt(t*t+e*e),Math.atan2(e,t)]}},{key:"createSensorSpec",value:function(t){var e=new Module.SensorSpec;for(var s in t){var n=t[s];e[s]=n}return e}},{key:"createAgentConfig",value:function(t){var e=new Module.AgentConfiguration;for(var s in t){var n=t[s];if("sensorSpecifications"===s){var o,i=new Module.VectorSensorSpec,a=C(n);try{for(a.s();!(o=a.n()).done;){var r=o.value;i.push_back(this.createSensorSpec(r))}}catch(t){a.e(t)}finally{a.f()}n=i}e[s]=n}return e}},{key:"createAgentState",value:function(t){var e=new Module.AgentState;for(var s in t){var n=t[s];e[s]=n}return e}}]),t}(),R=function(){function t(e,s){o()(this,t),this.pathFinder=e,this.bounds=e.bounds,this.canvas=s,this.ctx=s.getContext("2d"),this.widthComponent=0,this.heightComponent=2,this.scale=1,this.ctx.strokeStyle="blue",this.ctx.lineWidth=3,this.currentY=-1/0}return a()(t,[{key:"draw",value:function(){var t=this.ctx,e=this.canvas,s=this.mapCenterInset(),n=y()(s,2),o=n[0],i=n[1];t.clearRect(0,0,e.width,e.height),t.putImageData(this.imageData,o,i)}},{key:"start",value:function(t){this.currentY=t[1],this.imageData=this.createMap(),this.draw();var e=this.convertPosition(t),s=y()(e,2),n=s[0],o=s[1];this.ctx.beginPath(),this.ctx.moveTo(n,o)}},{key:"moveTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0!==e)this.throttledMoveTo||(this.throttledMoveTo=O(this.moveTo.bind(this),e)),this.throttledMoveTo(t);else if(t[1]<this.currentY-.25||t[1]>this.currentY+.25)this.start(t);else{var s=this.convertPosition(t),n=y()(s,2),o=n[0],i=n[1];this.ctx.lineTo(o,i),this.ctx.stroke()}}},{key:"mapCenterInset",value:function(){return[(this.canvas.width-this.imageData.width)/2,(this.canvas.height-this.imageData.height)/2]}},{key:"convertPosition",value:function(t){var e=this.widthComponent,s=this.heightComponent,n=this.mapCenterInset(),o=y()(n,2),i=o[0],a=o[1];return[i+=(t[e]-this.bounds.min[e])*this.scale,a+=(t[s]-this.bounds.min[s])*this.scale]}},{key:"createMap",value:function(){var t=this.canvas,e=this.bounds.max[0]-this.bounds.min[0],s=this.bounds.max[2]-this.bounds.min[2],n=0,o=0;if(e>s&&t.width<t.height||e<s&&t.width>t.height){this.widthComponent=2,this.heightComponent=0;var i=e;e=s,s=i}s/e>t.height/t.width?(this.scale=t.height/s,n=t.height,o=Math.round(e*this.scale-.5)):(this.scale=t.width/e,o=t.width,n=Math.round(s*this.scale-.5));var a,r,c=new ImageData(o,n),l=4*t.width,u=1/this.scale,d=this.bounds.min[this.heightComponent]+u/2;for(a=0;a<n;a++){var h=this.bounds.min[this.widthComponent]+u/2;for(r=0;r<o;r++){var b=[0,this.currentY,0];b[this.widthComponent]=h,b[this.heightComponent]=d,this.pathFinder.isNavigable(b,.5)&&(c.data[a*l+4*r]=255,c.data[a*l+4*r+1]=255,c.data[a*l+4*r+2]=255,c.data[a*l+4*r+3]=255),h+=u}d+=u}return c}}]),t}(),F=function(){function t(e,s,n,i){o()(this,t),this.rect=e,this.semanticShape=s,this.semanticScene=n,this.objectIds=[];for(var a=this.semanticScene.categories,r=this.semanticScene.objects,c=-1,l=0;l<a.size();l++){var u=a.get(l);if(u&&u.getName("")===i){c=u.getIndex("");break}}for(var d=0;d<r.size();d++){var h=r.get(d)||{};h.category&&h.category.getIndex("")===c&&this.objectIds.push(d)}}return a()(t,[{key:"computeIOU",value:function(t){for(var e=this.semanticShape.get(1),s=this.semanticShape.get(0),n=this.rect.left,o=this.rect.top,i=this.rect.right,a=this.rect.bottom,r=0,c=0,l=!1,u=0;u<s;u++){l=u>=o&&u<a;for(var d=0;d<e;d++)this.objectIds.includes(t[u*e+d])&&(l&&d>=n&&d<i?r++:c++)}return 0===r?0:r/(c+(a-o)*(i-n))}}]),t}(),E=function(){function t(e){o()(this,t),this.inventorySlots=e,this.inventory=new Array(e),this.inventoryComponent=null,this.inventoryEnabled=!1,this.inventoryCtx=null}return a()(t,[{key:"reset",value:function(){this.inventory=new Array(this.inventorySlots)}},{key:"initInventory",value:function(t){this.inventoryComponent=t,this.inventoryEnabled=!0,this.inventoryCtx=t.getContext("2d")}},{key:"setSlot",value:function(t,e){this.inventory[t]=e}},{key:"getSlot",value:function(t){return this.inventory[t]}},{key:"getEmptySlot",value:function(){for(var t=0;t<this.inventorySlots;t++)if(void 0===this.inventory[t])return t;return-1}},{key:"findObjectSlot",value:function(t){for(var e=0;e<this.inventorySlots;e++)if(void 0!==this.inventory[e]&&this.inventory[e].objectId===t)return e;return-1}},{key:"renderInventory",value:function(){var t=this;if(this.inventoryEnabled){var e=80*this.inventorySlots;""===this.inventoryComponent.style.border&&(this.inventoryComponent.style.border="5px solid #000000",this.inventoryComponent.width=e.toString());var s=this.inventoryCtx;s.clearRect(0,0,e,80),s.fillStyle="darkslategray";for(var n=function(e){var n=2+78*e;s.beginPath(),s.strokeStyle="grey",s.lineWidth=5,s.rect(n,2,76,76),s.stroke(),s.closePath();if(void 0!==t.inventory[e]){var o=new Image;o.src=t.inventory[e].objectIcon,o.addEventListener("load",(function(){s.drawImage(o,n+2,4,72,72)}))}},o=0;o<this.inventorySlots;++o)n(o)}}}]),t}(),H=function(){function t(e,s){o()(this,t),this.episode=e,this.sim=s,this.task=this.episode.task}return a()(t,[{key:"validate",value:function(){return void 0===this.task||("arrangement"===this.task.type?this.validateArrangementTask():"stacking"===this.task.type?this.validateStackingTask():void 0)}},{key:"validateArrangementTask",value:function(){var t=this.task.goals;if(void 0===t||void 0===t.objectToReceptacleMap)return!0;if(-1!=this.sim.grippedObjectId)return!1;var e=t.objectToReceptacleMap,s=this.sim.getObjectsInScene(),n=!1,o=this.sim.episode.objects;for(var i in o){var a=o[i].objectId,r=o[i].position,c=this.sim.convertVector3ToVec3f(this.sim.getTranslation(a,0));this.sim.geodesicDistance(r,c)>0&&(n=!0)}for(var l in e){for(var u=s[parseInt(l)].objectId,d=this.sim.convertVector3ToVec3f(this.sim.getTranslation(u,0)),h=e[l],b=!1,p=0;p<h.length;p++){var f=s[h[p]].objectId,g=this.sim.convertVector3ToVec3f(this.sim.getTranslation(f,0)),j=this.sim.geodesicDistance(d,g),v=g[1]+this.sim.getObjectBBYCoord(f);j<=.7&&d[1]>v&&(b=!0)}if(!b)return!1}return n}},{key:"validateStackingTask",value:function(){}}]),t}();function V(t,e){var s;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(s=function(t,e){if(!t)return;if("string"==typeof t)return B(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return B(t,e)}(t))||e&&t&&"number"==typeof t.length){s&&(t=s);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,r=!1;return{s:function(){s=t[Symbol.iterator]()},n:function(){var t=s.next();return a=t.done,t},e:function(t){r=!0,i=t},f:function(){try{a||null==s.return||s.return()}finally{if(r)throw i}}}}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=t[s];return n}var L=function(){function t(e,s){var n=this;if(o()(this,t),this.sim=e,this.components=s,this.topdown=s.topdown,this.semanticsEnabled=!1,this.radarEnabled=!1,this.keyBindListener=null,this.lastInteractedObjectId=-1,this.inventory=new E(1),this.taskValidator=null,this.components.semantic){if(this.semanticsEnabled=!0,this.semanticCtx=s.semantic.getContext("2d"),this.semanticShape=this.sim.getObservationSpace("semantic").shape,this.semanticImageData=this.semanticCtx.createImageData(this.semanticShape.get(1),this.semanticShape.get(0)),this.semanticObservation=new Module.Observation,this.semanticScene=this.sim.sim.getSemanticScene(),this.semanticObjects=this.semanticScene.objects,window.config.category){var i=this.components.scope.offsetWidth,a=this.components.scope.offsetHeight,r=(this.components.canvas.width-i)/2,c=(this.components.canvas.height-a)/2,l={left:r,top:c,right:r+i,bottom:c+a};this.objectSensor=new F(l,this.semanticShape,this.semanticScene,window.config.category)}s.canvas.onmousedown=function(t){n.handleMouseDown(t)}}this.components.radar&&(this.radarEnabled=!0,this.radarCtx=s.radar.getContext("2d")),this.components.inventory&&this.inventory.initInventory(s.inventory),this.components.taskValidator&&(this.taskValidator=this.components.taskValidator),this.psiturk=new A(window.psiTurk),this.actions=[{name:"moveForward",key:"w",keyCode:87},{name:"moveBackward",key:"s",keyCode:83},{name:"turnLeft",key:"ArrowLeft",keyCode:37},{name:"turnRight",key:"ArrowRight",keyCode:39},{name:"turnLeft",key:"a",keyCode:65},{name:"turnRight",key:"d",keyCode:68},{name:"lookUp",key:"ArrowUp",keyCode:38},{name:"lookDown",key:"ArrowDown",keyCode:40},{name:"grabReleaseObject",key:" ",keyCode:32}]}return a()(t,[{key:"handleMouseDown",value:function(t){var e=this.semanticShape.get(0),s=this.semanticShape.get(1),n=e-1-t.offsetY,o=t.offsetX,i=this.semanticData[s*n+o];this.setStatus(this.semanticObjects.get(i).category.getName(""))}},{key:"init",value:function(){this.bindKeys(),this.psiturk.handleRecordTrialData("TEST","simInitialized",{config:window.config}),this.initialized=!0,this.initPhysics()}},{key:"initPhysics",value:function(){var t=this;this.activeActions=[],this.activeActionIdx=0,this.frameCounter=0,Module.enablePhysics&&!0!==window.config.runFlythrough&&!0===window.config.enableStepPhysics&&(console.log("enabled physics step at 100ms interval"),this.physicsStepFunction=setInterval((function(){var e=t.popAction();"noOp"!=e&&t.handleAction(e);var s=(new Date).getTime();t.sim.stepWorld(.05),t.render();var n=t.sim.getAgentPose(),o=t.sim.getObjectStates(),i=t.sim.getObjectUnderCrosshair().nearestObjectId,a=[];-1!=t.sim.grippedObjectId&&(a=t.sim.findObjectFloorPositionUnderCrosshair(),a=t.sim.convertVector3ToVec3f(a)),t.psiturk.handleRecordTrialData("TEST","stepPhysics",{step:.05,agentState:n,objectStates:o,objectUnderCrosshair:i,objectDropPoint:a,totalTime:(new Date).getTime()-s}),t.frameCounter+=1}),50))}},{key:"disablePhysics",value:function(){this.physicsStepFunction&&(console.log("clearing physics interval on reset"),window.clearInterval(this.physicsStepFunction))}},{key:"reset",value:function(){this.lastInteractedObjectId=-1,this.disablePhysics(),this.sim.reset(),this.inventory.reset(),this.inventory.renderInventory(),this.setStatus("Ready"),this.initPhysics(),this.render()}},{key:"runFlythrough",value:function(t){var e=this;this.setStatus("Initializing...");var s=this;this.psiturk.handleRecordTrialData("TEST","flythroughStart",{});var n=!!this.keyBindListener;this.unbindKeys();var o=FS.readFile("/data/".concat(t),{encoding:"utf8"}).split(/\r?\n/),i=null,a=0,r=!1;this.replayTimeouts=[];for(var c=function(t){var n=o[t];if(0===n.length)return"continue";var c=n.split(","),l=c.slice(0,3)[2],u=c.slice(3).join(",");'"'==u[0]&&'"'==u[u.length-1]&&(u=function(t,e,s){for(;-1!==t.indexOf(e);)t=t.replace(e,s);return t}(u=u.slice(1,u.length-1),'""','"'));var d=JSON.parse(u);if(!1===r){if("viewer"!==d.step)return"continue";r=!0}i||(i=l);var h=(l-i)/1,b=window.setTimeout((function(){"simReset"===d.event?s.reset():"handleAction"==d.event?s.handleAction(d.data.action):"stepPhysics"==d.event&&(s.sim.stepWorld(.1),s.render())}),h);e.replayTimeouts.push(b),a=h},l=0;l<o.length;++l)c(l);this.clearTimeouts=function(){if(this.clearTimeouts=null,this.replayTimeouts){for(var t=0;t<this.replayTimeouts.length;++t){var e=this.replayTimeouts[t];window.clearTimeout(e)}delete this.replayTimeouts}n&&s.bindKeys(),s.setStatus("")};var u=window.setTimeout((function(){"function"==typeof this.clearTimeouts&&this.clearTimeouts(),window.finishTrial()}),a+1);this.replayTimeouts.push(u),this.psiturk.handleRecordTrialData("TEST","flythroughEnd",{})}},{key:"setTaskValidator",value:function(t){this.taskValidator=new H(t,this.sim)}},{key:"setStatus",value:function(t){this.components.status.style="color:white",this.components.status.innerHTML=t}},{key:"setErrorStatus",value:function(t){this.components.status.style="color:red",this.components.status.innerHTML=t}},{key:"setWarningStatus",value:function(t){this.components.status.style="color:orange",this.components.status.innerHTML=t}},{key:"setSuccessStatus",value:function(t){this.components.status.style="color:green",this.components.status.innerHTML=t}},{key:"renderImage",value:function(){this.sim.displayObservation("rgb"),this.renderRadar()}},{key:"renderSemanticImage",value:function(){if(this.semanticsEnabled&&0!=this.semanticObjects.size()){this.sim.getObservation("semantic",this.semanticObservation);var t=this.semanticObservation.getData(),e=new Uint32Array(t.buffer,t.byteOffset,t.length/4);this.semanticData=e;for(var s=0;s<e.length;s++){var n=e[s];this.semanticImageData.data[4*s]=1&n?255:0,this.semanticImageData.data[4*s+1]=2&n?255:0,this.semanticImageData.data[4*s+2]=4&n?255:0,this.semanticImageData.data[4*s+3]=255}this.semanticCtx.putImageData(this.semanticImageData,0,0)}}},{key:"renderTopDown",value:function(t){t.renderTopDown&&null!==this.topdown&&this.topdown.moveTo(this.sim.getAgentState().position,500)}},{key:"renderRadar",value:function(){if(this.radarEnabled){var t,e,s=this.radarCtx;s.clearRect(0,0,100,100),s.globalAlpha=.5,s.fillStyle="darkslategray",s.arc(50,50,50,0,2*Math.PI),s.fill(),s.fillStyle="darkgray",s.beginPath(),s.arc(50,50,50,3*-Math.PI/4,-Math.PI/4),s.lineTo(50,50),s.closePath(),s.fill(),s.globalAlpha=1,s.beginPath();var n=this.sim.distanceToGoal(),o=y()(n,2);t=o[0],e=o[1];var i=t/(t+1),a=50+50*Math.sin(e)*i,r=50-50*Math.cos(e)*i;s.fillStyle="maroon",s.arc(a,r,3,0,2*Math.PI),s.fill()}}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{renderTopDown:!0};this.renderImage(),this.sim.updateCrossHairNode(this.sim.getCrosshairPosition()),this.sim.drawBBAroundNearestObject(),this.sim.showDropPoint(),this.renderImage(),this.renderSemanticImage(),this.renderTopDown(t),this.numRendersSinceLastUpdate+=1}},{key:"handleInventoryUpdate",value:function(t){var e=this.sim.grippedObjectId;if(t)this.setStatus("Collision while releasing object!");else{if(-1==e){var s=this.inventory.findObjectSlot(this.lastInteractedObjectId);if(-1!=s&&this.inventory.setSlot(s,void 0),-1!=this.lastInteractedObjectId){var n=this.sim.getObjectFromScene(this.lastInteractedObjectId);this.setStatus(n.object+" released")}}else{var o=this.inventory.getEmptySlot(),i=this.sim.getObjectFromScene(e);-1==o?console.log("No empty slot in inventory!"):(this.inventory.setSlot(o,{objectId:e,object:i.object,objectIcon:i.objectIcon}),this.setStatus(i.object+" picked up"))}this.lastInteractedObjectId=e}}},{key:"validateTask",value:function(){return!window.config.runFlythrough&&this.taskValidator.validate()}},{key:"pushAction",value:function(t){0==this.activeActions.length&&this.activeActions.push(t)}},{key:"popAction",value:function(){if(this.activeActions.length>0){this.activeActionIdx=0;var t=this.activeActions[this.activeActionIdx];return"grabReleaseObject"==t&&this.removeActiveAction(t),t}return"noOp"}},{key:"handleAction",value:function(t){var e={},s=!1;if("addPrimitiveObject"===t)this.sim.addPrimitiveObject();else if("addTemplateObject"===t)this.sim.addTemplateObject();else if("removeLastObject"===t)this.sim.removeLastObject();else if("grabReleaseObject"==t){var n=this.sim.inventoryGrabReleaseObject();this.handleInventoryUpdate(n.collision),this.inventory.renderInventory(),e=n}else"agentPose"==t?console.log(this.sim.getAgentPose()):"stepWorld"==t?this.sim.stepWorld(.1):"dropObject"==t?(this.sim.dropObjectFromFloor2(),this.dropCalled=!0):(s=this.sim.step(t),this.setStatus(t));var o=this.sim.getAgentPose(),i=this.sim.getObjectStates(),a=this.sim.getObjectUnderCrosshair().nearestObjectId,r=[];-1!=this.sim.grippedObjectId&&(r=this.sim.findObjectFloorPositionUnderCrosshair(),r=this.sim.convertVector3ToVec3f(r)),this.psiturk.handleRecordTrialData("TEST","handleAction",{action:t,actionData:e,collision:s,objectUnderCrosshair:a,nearestObjectId:this.sim.nearestObjectId,grippedObjectId:this.sim.grippedObjectId,objectDropPoint:r,agentState:o,objectStates:i})}},{key:"removeActiveAction",value:function(t){var e=this.activeActions.indexOf(t);e>-1&&this.activeActions.splice(e,1)}},{key:"handleKeypressUp",value:function(t){var e,s=V(this.actions);try{for(s.s();!(e=s.n()).done;){var n=e.value;if(n.keyCode===t){this.removeActiveAction(n.name);break}}}catch(t){s.e(t)}finally{s.f()}}},{key:"handleKeypress",value:function(t){var e,s=V(this.actions);try{for(s.s();!(e=s.n()).done;){var n=e.value;if(n.keyCode===t){this.pushAction(n.name);break}}}catch(t){s.e(t)}finally{s.f()}}},{key:"bindKeys",value:function(){var t=this;t.keyBindListener?console.log("Keys already bound. Returning"):(t.keyBindListener=function(e){e.preventDefault(),t.handleKeypress(e.keyCode)},document.addEventListener("keydown",t.keyBindListener,!0),t.keyBindListener2=function(e){e.preventDefault(),t.handleKeypressUp(e.keyCode)},document.addEventListener("keyup",t.keyBindListener2,!0))}},{key:"unbindKeys",value:function(){this.keyBindListener&&(document.removeEventListener("keydown",this.keyBindListener,!0),this.keyBindListener=null,document.removeEventListener("keyup",this.keyBindListener2,!0),this.keyBindListener2=null)}}]),t}();function N(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,n)}return s}function U(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?N(Object(s),!0).forEach((function(e){c()(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):N(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var z=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"canvas";o()(this,t),c()(this,"currentResolution",d),this.canvasId=e}return a()(t,[{key:"initializeModules",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.config=new Module.SimulatorConfiguration,this.config.scene_id=Module.scene,this.config.enablePhysics=Module.enablePhysics,this.config.physicsConfigFile=Module.physicsConfigFile,this.simenv=new D(this.config,e,0),t=this.updateAgentConfigWithSensors(U({},t)),this.simenv.addAgent(t),this.simenv.updateCrossHairNode(this.simenv.resolution),this.topdown=s?new R(this.simenv.getPathFinder(),document.getElementById("topdown")):null,this.canvasElement=document.getElementById(this.canvasId),this.taskValidator=new H(e,this.simenv),this.task=new L(this.simenv,{topdown:this.topdown,canvas:this.canvasElement,inventory:document.getElementById("inventory"),semantic:document.getElementById("semantic"),radar:document.getElementById("radar"),scope:document.getElementById("scope"),status:document.getElementById("status"),fps:document.getElementById("fps"),taskValidator:this.taskValidator})}},{key:"setEpisode",value:function(t){var e=document.getElementById("task-instruction"),s=document.getElementById("text-assistance-1");if(null!=e&&(e.innerHTML="<hr> <h1>Task: "+t.task.instruction+"</h1> <hr>"),null!=s){var n=function(t){for(var e=t.objects,s={objects:[],receptacles:[]},n=0;n<e.length;n++){var o=e[n],i=o.object;i=i.charAt(0).toUpperCase()+i.slice(1);var a="<div><img src='"+o.objectIcon+"' style='border: 3px solid grey'/><div class='img-caption'>"+i+"</div></div>";o.isReceptacle?s.receptacles.push(a):s.objects.push(a)}return s}(t);n.objects.length>0&&n.receptacles.length>0&&(s.innerHTML="<div class='object-type'> Object: </div> <ul>"+n.objects.join("\n")+"</ul><br/><div class='object-type'> Receptacle: </div> <ul>"+n.receptacles.join("\n")+"</ul>")}this.simenv.setEpisode(t)}},{key:"setTaskValidator",value:function(t){this.task.setTaskValidator(t)}},{key:"runFlythrough",value:function(){window.config.disableLogging=!0,window.config.runFlythrough=!0,window.config.enableStepPhysics=!1,window.config.actualTask=!1;var t=window.config.taskConfig.flythroughTask.name,e=window.config.taskConfig.flythroughReplayFile.name,s=P("/data/".concat(t));this.setEpisode(s),this.setTaskValidator(s),this.task.reset(),this.task.runFlythrough(e)}},{key:"runInit",value:function(){window.config.disableLogging=!1,window.config.runFlythrough=!1,window.config.enableStepPhysics=!0,window.config.actualTask=!0;var t=window.config.episodeId,e=P("/data/".concat(window.config.taskConfig.name),t);this.setEpisode(e),this.setTaskValidator(e),this.task.reset()}},{key:"runTrainingTask",value:function(){window.config.disableLogging=!0,window.config.runFlythrough=!1,window.config.enableStepPhysics=!0,window.config.actualTask=!1;var t=window.config.taskConfig.trainingTask.name,e=P("/data/".concat(t));this.setEpisode(e),this.setTaskValidator(e),this.task.reset()}},{key:"updateAgentConfigWithSensors",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,e=[{uuid:"rgb",sensorType:Module.SensorType.COLOR,resolution:[480,640]},{uuid:"semantic",sensorType:Module.SensorType.SEMANTIC,resolution:[480,640],channels:1}];return t.sensorSpecifications=e,t=this.updateAgentConfigWithResolution(t)}},{key:"resetCanvas",value:function(t){this.canvasElement.width=t.width,this.canvasElement.height=t.height}},{key:"updateAgentConfigWithResolution",value:function(t){var e=this;return t.sensorSpecifications.forEach((function(t){t.resolution=[e.currentResolution.height,e.currentResolution.width]})),t}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=I();s.useDefaultEpisode&&(e=u),this.initializeModules(t,e),this.task.init(),this.task.reset()}},{key:"validateTask",value:function(){this.task.validateTask()}}]),t}(),W=s(2),q=s.n(W),K=s(6),Y=s.n(K),G=s(7),J=s.n(G),Q=s(8),$=s.n(Q),X=s(5),Z=s.n(X);function tt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var s,n=Z()(t);if(e){var o=Z()(this).constructor;s=Reflect.construct(n,arguments,o)}else s=n.apply(this,arguments);return $()(this,s)}}var et=function(t){J()(s,t);var e=tt(s);function s(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"canvas",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fps";return o()(this,s),t=e.call(this),c()(q()(t),"normalSceneFrame",void 0),c()(q()(t),"vrSceneFrame",void 0),c()(q()(t),"fpsElement",void 0),c()(q()(t),"lastPaintTime",void 0),c()(q()(t),"frameData",new VRFrameData),c()(q()(t),"previousRotation",!1),c()(q()(t),"previousPosition",!1),c()(q()(t),"currentVrDisplay",!1),c()(q()(t),"fps",0),c()(q()(t),"skipFrames",60),c()(q()(t),"currentFramesSkipped",0),t.canvasElement=document.getElementById(n),t.fpsElement=document.getElementById(i),t}return a()(s,[{key:"display",value:function(){this.setUpVR()}},{key:"initializeModules",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Y()(Z()(s.prototype),"initializeModules",this).call(this,t,e,n)}},{key:"setUpVR",value:function(){var t=this;navigator.getVRDisplays().then((function(e){e.length>0?t.setupDisplay(e[0]):(console.log("VR display not supported by this device"),Y()(Z()(s.prototype),"display",t).call(t))}))}},{key:"setupDisplay",value:function(t){var e=this;this.currentVrDisplay=t,this.currentVrDisplay.requestPresent([{source:this.canvasElement}]).then((function(){return e.setupCanvas()})).then((function(){return e.initializeModules()})).then((function(){return e.renderDisplay()}))}},{key:"renderDisplay",value:function(){this.task.reset(),this.drawVRScene()}},{key:"setupCanvas",value:function(){var t=this.currentVrDisplay.getEyeParameters("left"),e=this.currentVrDisplay.getEyeParameters("right"),s=2*Math.max(t.renderWidth,e.renderWidth),n=Math.max(t.renderHeight,e.renderHeight);this.currentResolution={height:n,width:s},this.resetCanvas(this.currentResolution)}},{key:"drawVRScene",value:function(){this.vrSceneFrame=this.currentVrDisplay.requestAnimationFrame(this.drawVRScene.bind(this)),this.currentVrDisplay.getFrameData(this.frameData),this.updateAgentState(),this.task.render({renderTopDown:!1}),this.currentVrDisplay.submitFrame(),this.updateFPS()}},{key:"updateAgentState",value:function(){var t=this,e=this.simenv.sim.getAgent(this.simenv.selectedAgentId),s=this.simenv.createAgentState({});e.getState(s);var n=s.rotation.slice(),o=s.position.slice();if(this.previousRotation){var i=this.frameData.pose.orientation,a=this.frameData.pose.position;i.forEach((function(e,s){n[s]+=e-t.previousRotation[s]})),a.forEach((function(e,s){o[s]+=e-t.previousPosition[s]})),this.previousRotation=i.slice(),this.previousPosition=a.slice()}else this.previousRotation=this.frameData.pose.orientation.slice(),this.previousPosition=this.frameData.pose.position.slice();var r={position:o,rotation:n};r=this.simenv.createAgentState(r),e.setState(r,!0)}},{key:"updateFPS",value:function(){if(this.currentFramesSkipped==this.skipFrames)if(this.currentFramesSkipped=0,this.lastPaintTime){var t=performance.now(),e=(t-this.lastPaintTime)/1e3;this.fps=this.skipFrames/e,this.lastPaintTime=t,this.fpsElement.innerHTML="FPS: ".concat(this.fps.toFixed(2))}else this.lastPaintTime=performance.now();else this.currentFramesSkipped++}}]),s}(z);s(19);function st(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var s,n=Z()(t);if(e){var o=Z()(this).constructor;s=Reflect.construct(n,arguments,o)}else s=n.apply(this,arguments);return $()(this,s)}}var nt=function(t){J()(s,t);var e=st(s);function s(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"canvas";return o()(this,s),(t=e.call(this,n)).canvasElement=document.getElementById(n),window.addEventListener("resize",t.windowResizeEvent.bind(q()(t))),t}return a()(s,[{key:"initializeModules",value:function(){for(var t,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];3===n.length?n[2]=!1:2==n.length&&n.push(!1),(t=Y()(Z()(s.prototype),"initializeModules",this)).call.apply(t,[this].concat(n))}},{key:"resetCanvasToCurrent",value:function(){this.currentResolution={height:this.canvasElement.offsetHeight,width:this.canvasElement.offsetWidth},this.resetCanvas(this.currentResolution)}},{key:"display",value:function(){this.resetCanvasToCurrent(),Y()(Z()(s.prototype),"display",this).call(this)}},{key:"windowResizeEvent",value:function(){}}]),s}(z);s(21);function ot(t){var e=t;if(0===t.indexOf("http")){var s=t.split("/");e=s[s.length-1]}return FS.createPreloadedFile("/",e,"data/scenes/".concat(t),!0,!1),e}function it(t,e){FS.createPreloadedFile("/data",t.name,"data/".concat(t.config),!0,!1),FS.createPreloadedFile("/data",e.name,"data/".concat(e.location),!0,!1)}Module.preRun.push((function(){for(var t=decodeURIComponent(window.location.search.substr(1)).trim().split("&"),e=0;e!=t.length;++e){var s=t[e].indexOf("=");-1!=s?(Module.arguments.push("--"+t[e].substring(0,s)),Module.arguments.push(t[e].substring(s+1))):Module.arguments.push("--"+t[e])}var n={};n.scene=h,I(n),window.config=n;var o=j.tasks[parseInt(window.config.task)];window.config.taskConfig=o,void 0!==o&&(n.scene=o.scene,window.config.scene=o.scene);var i=n.scene;Module.scene=ot(i);var a=window.config.defaultPhysConfig;Module.physicsConfigFile=function(t){FS.mkdir("/data");var e=t;if(0===t.indexOf("http")){var s=t.split("/");e=s[s.length-1]}FS.createPreloadedFile("/data",e,"data/".concat(t),!0,!1);var n="/data".concat("/objects");FS.mkdir(n);var o=p.objects;for(var i in o){var a=o[i].physicsProperties,r=a.split("/")[a.split("/").length-1],c=o[i].renderMesh,l=c.split("/")[c.split("/").length-1];FS.createPreloadedFile(n,l,"data/".concat(c),!0,!1),FS.createPreloadedFile(n,r,"data/".concat(a),!0,!1)}return"/data".concat("/".concat(e))}(a),Module.enablePhysics="true"===window.config.enablePhysics,window.config.runFlythrough="true"===window.config.runFlythrough,window.config.enableStepPhysics="true"===window.config.enableStepPhysics,function(t){if(void 0!==t){var e=t.name,s=t.config;FS.createPreloadedFile("/data",e,"data/".concat(s),!0,!1),FS.createPreloadedFile("/data",t.trainingTask.name,"data/".concat(t.trainingTask.config),!0,!1)}}(o),null!=o?it(o.flythroughTask,o.flythroughReplayFile):it(f,g);var r=i.substr(0,i.lastIndexOf("."));window.config.recomputeNavMesh||(ot(r+".navmesh"),ot(r+".stage_config.json")),"mp3d"===n.semantic?(ot(r+".house"),ot(r+"_semantic.ply")):"replica"===n.semantic&&ot(function(t){var e=t.split("/"),s=e.length>1;e.pop();var n="info_semantic.json";return s&&(n="/"+n),e.join("/")+n}(n.scene))})),Module.onRuntimeInitialized=function(){var t;if(console.log("hsim_bindings initialized"),window.vrEnabled?navigator&&navigator.getVRDisplays&&(console.log("Web VR is supported"),t=new et):window.viewerEnabled&&(t=new nt),t||(t=new z),void 0!==window.config.taskConfig){var e=P("/data/".concat(window.config.taskConfig.name),window.config.episodeId);t.display(void 0,e)}else t.display();!0===window.config.runFlythrough&&t.runFlythrough(),window.demo=t},function(){var t=function(){var t,e,s=!1;try{e=(t=document.createElement("canvas")).getContext("webgl")||t.getContext("experimental-webgl")}catch(t){return}return void 0!==e&&(s=!0),t=void 0,s?2:"undefined"!=typeof WebGL2RenderingContext?1:0}(),e="";if(t?1===t&&(e="WebGL2 is supported on your browser, but not enabled. "):e="WebGL2 is not supported on your browser. ",function(){try{if("object"===("undefined"==typeof WebAssembly?"undefined":_()(WebAssembly))&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){return!1}return!1}()||(e+="Web Assembly is not supported in your browser"),e.length>0){var s=document.getElementById("warning");s.innerHTML=e,s.className=""}}()}]);
//# sourceMappingURL=bundle.js.map